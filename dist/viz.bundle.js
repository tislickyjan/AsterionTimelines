/*! For license information please see viz.bundle.js.LICENSE.txt */
(()=>{var t={471:t=>{t.exports=function(){function t(e,n,i){function r(a,o){if(!n[a]){if(!e[a]){if(s)return s(a,!0);var y=new Error("Cannot find module '"+a+"'");throw y.code="MODULE_NOT_FOUND",y}var l=n[a]={exports:{}};e[a][0].call(l.exports,(function(t){return r(e[a][1][t]||t)}),l,l.exports,t,e,n,i)}return n[a].exports}for(var s=void 0,a=0;a<i.length;a++)r(i[a]);return r}return t}()({1:[function(t,e,n){n.Point2D=t("./lib/Point2D"),n.Vector2D=t("./lib/Vector2D"),n.Matrix2D=t("./lib/Matrix2D")},{"./lib/Matrix2D":2,"./lib/Point2D":3,"./lib/Vector2D":4}],2:[function(t,e,n){function i(t,e,n,i,r,s){Object.defineProperties(this,{a:{value:void 0!==t?t:1,writable:!1,enumerable:!0,configurable:!1},b:{value:void 0!==e?e:0,writable:!1,enumerable:!0,configurable:!1},c:{value:void 0!==n?n:0,writable:!1,enumerable:!0,configurable:!1},d:{value:void 0!==i?i:1,writable:!1,enumerable:!0,configurable:!1},e:{value:void 0!==r?r:0,writable:!1,enumerable:!0,configurable:!1},f:{value:void 0!==s?s:0,writable:!1,enumerable:!0,configurable:!1}})}i.IDENTITY=new i(1,0,0,1,0,0),i.IDENTITY.isIdentity=function(){return!0},i.prototype.multiply=function(t){return this.isIdentity()?t:t.isIdentity()?this:new this.constructor(this.a*t.a+this.c*t.b,this.b*t.a+this.d*t.b,this.a*t.c+this.c*t.d,this.b*t.c+this.d*t.d,this.a*t.e+this.c*t.f+this.e,this.b*t.e+this.d*t.f+this.f)},i.prototype.inverse=function(){if(this.isIdentity())return this;var t=this.a*this.d-this.b*this.c;if(0===t)throw"Matrix is not invertible";var e=1/t,n=this.f*this.c-this.e*this.d,i=this.e*this.b-this.f*this.a;return new this.constructor(this.d*e,-this.b*e,-this.c*e,this.a*e,n*e,i*e)},i.prototype.translate=function(t,e){return new this.constructor(this.a,this.b,this.c,this.d,this.a*t+this.c*e+this.e,this.b*t+this.d*e+this.f)},i.prototype.scale=function(t){return new this.constructor(this.a*t,this.b*t,this.c*t,this.d*t,this.e,this.f)},i.prototype.scaleAt=function(t,e){var n=e.x-t*e.x,i=e.y-t*e.y;return new this.constructor(this.a*t,this.b*t,this.c*t,this.d*t,this.a*n+this.c*i+this.e,this.b*n+this.d*i+this.f)},i.prototype.scaleNonUniform=function(t,e){return new this.constructor(this.a*t,this.b*t,this.c*e,this.d*e,this.e,this.f)},i.prototype.scaleNonUniformAt=function(t,e,n){var i=n.x-t*n.x,r=n.y-e*n.y;return new this.constructor(this.a*t,this.b*t,this.c*e,this.d*e,this.a*i+this.c*r+this.e,this.b*i+this.d*r+this.f)},i.prototype.rotate=function(t){var e=Math.cos(t),n=Math.sin(t);return new this.constructor(this.a*e+this.c*n,this.b*e+this.d*n,this.a*-n+this.c*e,this.b*-n+this.d*e,this.e,this.f)},i.prototype.rotateAt=function(t,e){var n=Math.cos(t),i=Math.sin(t),r=-e.x+e.x*n-e.y*i,s=-e.y+e.y*n+e.x*i;return new this.constructor(this.a*n+this.c*i,this.b*n+this.d*i,this.a*-i+this.c*n,this.b*-i+this.d*n,this.a*r+this.c*s+this.e,this.b*r+this.d*s+this.f)},i.prototype.rotateFromVector=function(t){var e=t.unit(),n=e.x,i=e.y;return new this.constructor(this.a*n+this.c*i,this.b*n+this.d*i,this.a*-i+this.c*n,this.b*-i+this.d*n,this.e,this.f)},i.prototype.flipX=function(){return new this.constructor(-this.a,-this.b,this.c,this.d,this.e,this.f)},i.prototype.flipY=function(){return new this.constructor(this.a,this.b,-this.c,-this.d,this.e,this.f)},i.prototype.skewX=function(t){var e=Math.tan(t);return new this.constructor(this.a,this.b,this.a*e+this.c,this.b*e+this.d,this.e,this.f)},i.prototype.skewY=function(t){var e=Math.tan(t);return new this.constructor(this.a+this.c*e,this.b+this.d*e,this.c,this.d,this.e,this.f)},i.prototype.isIdentity=function(){return 1===this.a&&0===this.b&&0===this.c&&1===this.d&&0===this.e&&0===this.f},i.prototype.isInvertible=function(){return this.a*this.d-this.b*this.c!=0},i.prototype.getScale=function(){return{scaleX:Math.sqrt(this.a*this.a+this.c*this.c),scaleY:Math.sqrt(this.b*this.b+this.d*this.d)}},i.prototype.getDecomposition=function(){var t=.5*(this.a+this.d),e=.5*(this.a-this.d),n=.5*(this.b+this.c),i=.5*(this.b-this.c),r=Math.sqrt(t*t+i*i),s=Math.sqrt(e*e+n*n),a=r+s,o=r-s,y=Math.atan2(n,e),l=Math.atan2(i,t),x=.5*(l-y),c=.5*(l+y);return{translation:new this.constructor(1,0,0,1,this.e,this.f),rotation:this.constructor.IDENTITY.rotate(c),scale:new this.constructor(a,0,0,o,0,0),rotation0:this.constructor.IDENTITY.rotate(x)}},i.prototype.equals=function(t){return this.a===t.a&&this.b===t.b&&this.c===t.c&&this.d===t.d&&this.e===t.e&&this.f===t.f},i.prototype.toString=function(){return"matrix("+[this.a,this.b,this.c,this.d,this.e,this.f].join(",")+")"},void 0!==e&&(e.exports=i)},{}],3:[function(t,e,n){function i(t,e){Object.defineProperties(this,{x:{value:t,writable:!1,enumerable:!0,configurable:!1},y:{value:e,writable:!1,enumerable:!0,configurable:!1}})}i.prototype.clone=function(){return new this.constructor(this.x,this.y)},i.prototype.add=function(t){return new this.constructor(this.x+t.x,this.y+t.y)},i.prototype.subtract=function(t){return new this.constructor(this.x-t.x,this.y-t.y)},i.prototype.multiply=function(t){return new this.constructor(this.x*t,this.y*t)},i.prototype.divide=function(t){return new this.constructor(this.x/t,this.y/t)},i.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},i.prototype.lerp=function(t,e){var n=1-e;return new this.constructor(this.x*n+t.x*e,this.y*n+t.y*e)},i.prototype.distanceFrom=function(t){var e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)},i.prototype.min=function(t){return new this.constructor(Math.min(this.x,t.x),Math.min(this.y,t.y))},i.prototype.max=function(t){return new this.constructor(Math.max(this.x,t.x),Math.max(this.y,t.y))},i.prototype.transform=function(t){return new this.constructor(t.a*this.x+t.c*this.y+t.e,t.b*this.x+t.d*this.y+t.f)},i.prototype.toString=function(){return"point("+this.x+","+this.y+")"},void 0!==e&&(e.exports=i)},{}],4:[function(t,e,n){function i(t,e){Object.defineProperties(this,{x:{value:t,writable:!1,enumerable:!0,configurable:!1},y:{value:e,writable:!1,enumerable:!0,configurable:!1}})}i.fromPoints=function(t,e){return new i(e.x-t.x,e.y-t.y)},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i.prototype.magnitude=function(){return this.x*this.x+this.y*this.y},i.prototype.dot=function(t){return this.x*t.x+this.y*t.y},i.prototype.cross=function(t){return this.x*t.y-this.y*t.x},i.prototype.determinant=function(t){return this.x*t.y-this.y*t.x},i.prototype.unit=function(){return this.divide(this.length())},i.prototype.add=function(t){return new this.constructor(this.x+t.x,this.y+t.y)},i.prototype.subtract=function(t){return new this.constructor(this.x-t.x,this.y-t.y)},i.prototype.multiply=function(t){return new this.constructor(this.x*t,this.y*t)},i.prototype.divide=function(t){return new this.constructor(this.x/t,this.y/t)},i.prototype.angleBetween=function(t){var e=this.dot(t)/(this.length()*t.length());e=Math.max(-1,Math.min(e,1));var n=Math.acos(e);return this.cross(t)<0?-n:n},i.prototype.perp=function(){return new this.constructor(-this.y,this.x)},i.prototype.perpendicular=function(t){return this.subtract(this.project(t))},i.prototype.project=function(t){var e=this.dot(t)/t.dot(t);return t.multiply(e)},i.prototype.transform=function(t){return new this.constructor(t.a*this.x+t.c*this.y,t.b*this.x+t.d*this.y)},i.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},i.prototype.toString=function(){return"vector("+this.x+","+this.y+")"},void 0!==e&&(e.exports=i)},{}],5:[function(t,e,n){n.Polynomial=t("./lib/Polynomial"),n.SqrtPolynomial=t("./lib/SqrtPolynomial")},{"./lib/Polynomial":6,"./lib/SqrtPolynomial":7}],6:[function(t,e,n){function i(){this.init(arguments)}i.TOLERANCE=1e-6,i.ACCURACY=15,i.interpolate=function(t,e,n,i,r){if(t.constructor!==Array||e.constructor!==Array)throw new Error("Polynomial.interpolate: xs and ys must be arrays");if(isNaN(n)||isNaN(i)||isNaN(r))throw new Error("Polynomial.interpolate: n, offset, and x must be numbers");for(var s=0,a=0,o=new Array(n),y=new Array(n),l=0,x=Math.abs(r-t[i]),c=0;c<n;c++){var h=Math.abs(r-t[i+c]);h<x&&(l=c,x=h),o[c]=y[c]=e[i+c]}s=e[i+l],l--;for(var p=1;p<n;p++){for(c=0;c<n-p;c++){var d=t[i+c]-r,u=t[i+c+p]-r,m=o[c+1]-y[c],f=d-u;if(0==f)break;f=m/f,y[c]=u*f,o[c]=d*f}s+=a=2*(l+1)<n-p?o[l+1]:y[l--]}return{y:s,dy:a}},i.prototype.init=function(t){this.coefs=new Array;for(var e=t.length-1;e>=0;e--)this.coefs.push(t[e]);this._variable="t",this._s=0},i.prototype.eval=function(t){if(isNaN(t))throw new Error("Polynomial.eval: parameter must be a number");for(var e=0,n=this.coefs.length-1;n>=0;n--)e=e*t+this.coefs[n];return e},i.prototype.add=function(t){for(var e=new i,n=this.getDegree(),r=t.getDegree(),s=Math.max(n,r),a=0;a<=s;a++){var o=a<=n?this.coefs[a]:0,y=a<=r?t.coefs[a]:0;e.coefs[a]=o+y}return e},i.prototype.multiply=function(t){for(var e=new i,n=0;n<=this.getDegree()+t.getDegree();n++)e.coefs.push(0);for(n=0;n<=this.getDegree();n++)for(var r=0;r<=t.getDegree();r++)e.coefs[n+r]+=this.coefs[n]*t.coefs[r];return e},i.prototype.divide_scalar=function(t){for(var e=0;e<this.coefs.length;e++)this.coefs[e]/=t},i.prototype.simplify=function(){for(var t=1e-15,e=this.getDegree();e>=0&&Math.abs(this.coefs[e])<=t;e--)this.coefs.pop()},i.prototype.bisection=function(t,e){var n,r=this.eval(t),s=this.eval(e);if(Math.abs(r)<=i.TOLERANCE)n=t;else if(Math.abs(s)<=i.TOLERANCE)n=e;else if(r*s<=0)for(var a=Math.log(e-t),o=Math.LN10*i.ACCURACY,y=Math.ceil((a+o)/Math.LN2),l=0;l<y;l++){n=.5*(t+e);var x=this.eval(n);if(Math.abs(x)<=i.TOLERANCE)break;x*r<0?(e=n,s=x):(t=n,r=x)}return n},i.prototype.toString=function(){for(var t=new Array,e=new Array,n=this.coefs.length-1;n>=0;n--){var i=Math.round(1e3*this.coefs[n])/1e3;if(0!=i){var r=i<0?" - ":" + ";i=Math.abs(i),n>0&&(1==i?i=this._variable:i+=this._variable),n>1&&(i+="^"+n),e.push(r),t.push(i)}}e[0]=" + "==e[0]?"":"-";var s="";for(n=0;n<t.length;n++)s+=e[n]+t[n];return s},i.prototype.trapezoid=function(t,e,n){if(isNaN(t)||isNaN(e)||isNaN(n))throw new Error("Polynomial.trapezoid: parameters must be numbers");var i=e-t;if(1==n){var r=this.eval(t),s=this.eval(e);this._s=.5*i*(r+s)}else{for(var a=1<<n-2,o=i/a,y=t+.5*o,l=0,x=0;x<a;x++)l+=this.eval(y),y+=o;this._s=.5*(this._s+i*l/a)}if(isNaN(this._s))throw new Error("Polynomial.trapezoid: this._s is NaN");return this._s},i.prototype.simpson=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Polynomial.simpson: parameters must be numbers");for(var n=e-t,i=.5*n*(this.eval(t)+this.eval(e)),r=i,s=4*i/3,a=s,o=i,y=1e-7,l=1,x=2;x<=20;x++){for(var c=n/l,h=t+.5*c,p=0,d=1;d<=l;d++)p+=this.eval(h),h+=c;if(s=(4*(i=r=.5*(r+n*p/l))-o)/3,Math.abs(s-a)<y*Math.abs(a))break;a=s,o=i,l<<=1}return s},i.prototype.romberg=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Polynomial.romberg: parameters must be numbers");var n=20,r=3,s=1e-6,a=new Array(n+1),o=new Array(n+1),y={y:0,dy:0};o[0]=1;for(var l=1;l<=n&&(a[l-1]=this.trapezoid(t,e,l),!(l>=r&&(y=i.interpolate(o,a,r,l-r,0),Math.abs(y.dy)<=s*y.y)));l++)a[l]=a[l-1],o[l]=.25*o[l-1];return y.y},i.prototype.getDegree=function(){return this.coefs.length-1},i.prototype.getDerivative=function(){for(var t=new i,e=1;e<this.coefs.length;e++)t.coefs.push(e*this.coefs[e]);return t},i.prototype.getRoots=function(){var t;switch(this.simplify(),this.getDegree()){case 0:default:t=new Array;break;case 1:t=this.getLinearRoot();break;case 2:t=this.getQuadraticRoots();break;case 3:t=this.getCubicRoots();break;case 4:t=this.getQuarticRoots()}return t},i.prototype.getRootsInInterval=function(t,e){var n,i=new Array;if(1==this.getDegree())null!=(n=this.bisection(t,e))&&i.push(n);else{var r=this.getDerivative().getRootsInInterval(t,e);if(r.length>0){null!=(n=this.bisection(t,r[0]))&&i.push(n);for(var s=0;s<=r.length-2;s++)null!=(n=this.bisection(r[s],r[s+1]))&&i.push(n);null!=(n=this.bisection(r[r.length-1],e))&&i.push(n)}else null!=(n=this.bisection(t,e))&&i.push(n)}return i},i.prototype.getLinearRoot=function(){var t=new Array,e=this.coefs[1];return 0!=e&&t.push(-this.coefs[0]/e),t},i.prototype.getQuadraticRoots=function(){var t=new Array;if(2==this.getDegree()){var e=this.coefs[2],n=this.coefs[1]/e,i=n*n-this.coefs[0]/e*4;if(i>0){var r=Math.sqrt(i);t.push(.5*(-n+r)),t.push(.5*(-n-r))}else 0==i&&t.push(.5*-n)}return t},i.prototype.getCubicRoots=function(){var t=new Array;if(3==this.getDegree()){var e=this.coefs[3],n=this.coefs[2]/e,i=this.coefs[1]/e,r=(3*i-n*n)/3,s=(2*n*n*n-9*i*n+this.coefs[0]/e*27)/27,a=n/3,o=s*s/4+r*r*r/27,y=s/2,l=this.zeroErrorEstimate();if(Math.abs(o)<=l&&(o=0),o>0){var x,c=Math.sqrt(o);x=(f=-y+c)>=0?Math.pow(f,1/3):-Math.pow(-f,1/3),(f=-y-c)>=0?x+=Math.pow(f,1/3):x-=Math.pow(-f,1/3),t.push(x-a)}else if(o<0){var h=Math.sqrt(-r/3),p=Math.atan2(Math.sqrt(-o),-y)/3,d=Math.cos(p),u=Math.sin(p),m=Math.sqrt(3);t.push(2*h*d-a),t.push(-h*(d+m*u)-a),t.push(-h*(d-m*u)-a)}else{var f;f=y>=0?-Math.pow(y,1/3):Math.pow(-y,1/3),t.push(2*f-a),t.push(-f-a)}}return t};var r=function(t){return"number"==typeof t?t?t<0?-1:1:t==t?t:NaN:NaN};i.prototype.getQuarticRoots=function(){var t=[],e=this.getDegree();if(4==e){var n=new i;n.coefs=this.coefs.slice(),n.divide_scalar(n.coefs[e]);var s=1e-15;Math.abs(n.coefs[0])<10*s*Math.abs(n.coefs[3])&&(n.coefs[0]=0);var a,o=n.getDerivative(),y=o.getRoots().sort((function(t,e){return t-e})),l=[],x=y.length-1,c=this.bounds();maxabsX=Math.max(Math.abs(c.minX),Math.abs(c.maxX));var h=this.zeroErrorEstimate(maxabsX);for(a=0;a<=x;a++)l.push(n.eval(y[a]));for(a=0;a<=x;a++)Math.abs(l[a])<h&&(l[a]=0);a=0;var p=Math.max(.1*(c.maxX-c.minX)/e,s),d=[],u=[];if(x>-1){for(0!=l[0]?r(l[0])!=r(n.eval(y[0]-p)-l[0])&&(d.push(y[0]-p),u.push([c.minX,y[0]])):(t.push(y[0],y[0]),a++);a<x;a++)0==l[a+1]?(t.push(y[a+1],y[a+1]),a++):r(l[a])!=r(l[a+1])&&(d.push((y[a]+y[a+1])/2),u.push([y[a],y[a+1]]));0!=l[x]&&r(l[x])!=r(n.eval(y[x]+p)-l[x])&&(d.push(y[x]+p),u.push([y[x],c.maxX]))}var m=function(t){return n.eval(t)},f=function(t){return o.eval(t)};if(d.length>0)for(a=0;a<d.length;a++)d[a]=i.newton_secant_bisection(d[a],m,f,32,u[a][0],u[a][1]);t=t.concat(d)}return t},i.prototype.zeroErrorEstimate=function(t){var e=this,n=1e-15;if(void 0===t){var i=e.bounds();t=Math.max(Math.abs(i.minX),Math.abs(i.maxX))}if(t<.001)return 2*Math.abs(e.eval(n));var r=e.coefs.length-1,s=e.coefs[r];return 10*n*e.coefs.reduce((function(e,n,i){var r=n/s*Math.pow(t,i);return r>e?r:e}),0)},i.prototype.bounds_UpperReal_Fujiwara=function(){var t=this.coefs,e=t.length-1,n=t[e];1!=n&&(t=this.coefs.map((function(t){return t/n})));var i,r=t.map((function(t,n){return n<e?Math.pow(Math.abs(0==n?t/2:t),1/(e-n)):t})),s=function(t,e,n){return i(n)&&(t.max<e?(t.nearmax=t.max,t.max=e):t.nearmax<e&&(t.nearmax=e)),t};i=function(n){return n<e&&t[n]<0};var a=r.reduce(s,{max:0,nearmax:0});return i=function(n){return n<e&&(e%2==n%2?t[n]<0:t[n]>0)},{negX:-2*r.reduce(s,{max:0,nearmax:0}).max,posX:2*a.max}},i.prototype.bounds_LowerReal_Fujiwara=function(){var t=new i;t.coefs=this.coefs.slice().reverse();var e=t.bounds_UpperReal_Fujiwara();return e.negX=1/e.negX,e.posX=1/e.posX,e},i.prototype.bounds=function(){var t=this.bounds_UpperReal_Fujiwara(),e={minX:t.negX,maxX:t.posX};return 0===t.negX&&0===t.posX||(0===t.negX?e.minX=this.bounds_LowerReal_Fujiwara().posX:0===t.posX&&(e.maxX=this.bounds_LowerReal_Fujiwara().negX),e.minX>e.maxX&&(e.minX=e.maxX=0)),e},i.newton_secant_bisection=function(t,e,n,i,s,a){var o,l,x,c,h,p,d=0,u=0;o=t;var m=14,f=Math.pow(10,-m),v="number"==typeof s&&"number"==typeof a;if(v){if(s>a)throw new Error("newton root finding: min must be greater than max");if(h=e(s),p=e(a),r(h)==r(p))throw new Error("newton root finding: y values of bounds must be of opposite sign")}var g,w=function(){return Math.abs(x)<=f*Math.abs(o)||u==o-x-o};for(g=0;g<i;g++){if(0==(l=n(o))){if(0==d)throw new Error("newton root finding: df(x) is zero");l=d}if(d=l,y=e(o),x=y/l,c=o-x,w())break;if(v){if(r(y)==r(p))a=o,p=y;else{if(r(y)!=r(h)){o=c;break}s=o,h=y}if(c<s||c>a){if(r(h)==r(p))break;var b=50,E=.25,P=p-h,k=a-s;if(x=0==P?o-(s+.5*k):Math.abs(P/Math.min(h,p))>b?o-(s+k*(.5+(Math.abs(h)<Math.abs(p)?-E:E))):o-(s-h/P*k),c=o-x,w())break}}u=o-c,o=c}return o},void 0!==e&&(e.exports=i)},{}],7:[function(t,e,n){if(void 0!==e)var i=t("./Polynomial");function r(){this.init(arguments)}r.VERSION=1,r.prototype=new i,r.prototype.constructor=r,r.superclass=i.prototype,r.prototype.eval=function(t){var e=1e-7,n=r.superclass.eval.call(this,t);if(Math.abs(n)<e&&(n=0),n<0)throw new Error("SqrtPolynomial.eval: cannot take square root of negative number");return Math.sqrt(n)},r.prototype.toString=function(){return"sqrt("+r.superclass.toString.call(this)+")"},void 0!==e&&(e.exports=r)},{"./Polynomial":6}],8:[function(t,e,n){n.intersect=t("./lib/intersect"),n.shape=t("./lib/IntersectionParams").newShape},{"./lib/IntersectionParams":10,"./lib/intersect":12}],9:[function(t,e,n){function i(t){this.init(t)}i.prototype.init=function(t){this.status=t,this.points=[]},i.prototype.appendPoint=function(t){this.points.push(t)},i.prototype.appendPoints=function(t){this.points=this.points.concat(t)},e.exports=i},{}],10:[function(t,e,n){var i=t("kld-affine").Point2D;function r(t,e,n,r,s,a,o){function y(t,e,n,i){var r=t*n+e*i,s=Math.sqrt((t*t+e*e)*(n*n+i*i)),a=Math.acos(r/s);return t*i-e*n<0&&(a=-a),a}s=s*Math.PI/180;var l,x=Math.cos(s),c=Math.sin(s),h=1e-6,p=t.subtract(e).divide(2),d=p.x*x+p.y*c,u=p.x*-c+p.y*x,m=d*d,f=u*u,v=m/(n*n)+f/(r*r);v>1&&(n*=l=Math.sqrt(v),r*=l);var g=n*n,w=r*r,b=g*f,E=w*m;l=(g*w-b-E)/(b+E),Math.abs(l)<h&&(l=0);var P=Math.sqrt(l);a==o&&(P=-P);for(var k=t.add(e).divide(2),I=P*n*u/r,M=P*-r*d/n,D=(d-I)/n,N=(d+I)/n,C=(u-M)/r,S=(u+M)/r,A=y(1,0,D,C),L=y(D,C,-N,-S),R=2*Math.PI;L>R;)L-=R;for(;L<0;)L+=R;return 0==o&&(L-=R),{center:new i(I*x-M*c+k.x,I*c+M*x+k.y),rx:n,ry:r,theta1:A,deltaTheta:L}}function s(t,e){this.init(t,e)}s.prototype.init=function(t,e){this.type=t,this.params=e,this.meta={}},s.TYPE={};var a=s.TYPE;function o(t){return t.split(" ").map((function(t){return t=t.split(","),new i(t[0],t[1])}))}a.LINE="Line",a.RECT="Rectangle",a.ROUNDRECT="RoundRectangle",a.CIRCLE="Circle",a.ELLIPSE="Ellipse",a.POLYGON="Polygon",a.POLYLINE="Polyline",a.PATH="Path",a.ARC="Arc",a.BEZIER2="Bezier2",a.BEZIER3="Bezier3",s.newShape=function(t,e){return"line"===(t=t.toLowerCase())?s.newLine(new i(e.x1,e.y1),new i(e.x2,e.y2)):"rect"===t?e.rx>0||e.ry>0?s.newRoundRect(e.x,e.y,e.width,e.height,e.rx,e.ry):s.newRect(e.x,e.y,e.width,e.height):"circle"===t?s.newCircle(new i(e.cx,e.cy),e.r):"ellipse"===t?s.newEllipse(new i(e.cx,e.cy),e.rx,e.ry):"polygon"===t?s.newPolygon(o(e.points)):"polyline"===t?s.newPolyline(o(e.points)):"path"===t?s.newPath(e.d):void 0},s.newArc=function(t,e,n,i,o,y,l){var x=r(t,e,n,i,o,y,l);return new s(a.ARC,[x.center,x.rx,x.ry,o*Math.PI/180,x.theta1,x.deltaTheta])},s.newBezier2=function(t,e,n){return new s(a.BEZIER2,[t,e,n])},s.newBezier3=function(t,e,n,i){return new s(a.BEZIER3,[t,e,n,i])},s.newCircle=function(t,e){return new s(a.CIRCLE,[t,e])},s.newEllipse=function(t,e,n){return new s(a.ELLIPSE,[t,e,n])},s.newLine=function(t,e){return new s(a.LINE,[t,e])},s.newPolygon=function(t){return new s(a.POLYGON,[t])},s.newPolyline=function(t){return new s(a.POLYLINE,[t])},s.newRect=function(t,e,n,r){var o=[];return o.push(new i(t,e)),o.push(new i(t+n,e)),o.push(new i(t+n,e+r)),o.push(new i(t,e+r)),new s(a.RECT,[o])};var y=function(t){return t*Math.PI/180};function l(t,e){arguments.length>0&&this.init(t,e)}s.newRoundRect=function(t,e,n,r,o,l){if(0===o&&0===l)return s.newRect(t,e,n,r);0===o&&(o=l),0===l&&(l=o),o>n/2&&(o=n/2),l>r/2&&(o=r/2);var x=[],c=t,h=t+o,p=t+n-o,d=t+n,u=e,m=e+l,f=e+r-l,v=e+r;return x.push(new s(a.ARC,[new i(h,m),o,l,0,y(180),y(90)])),x.push(new s(a.LINE,[new i(h,u),new i(p,u)])),x.push(new s(a.ARC,[new i(p,m),o,l,0,y(-90),y(90)])),x.push(new s(a.LINE,[new i(d,m),new i(d,f)])),x.push(new s(a.ARC,[new i(p,f),o,l,0,y(0),y(90)])),x.push(new s(a.LINE,[new i(p,v),new i(h,v)])),x.push(new s(a.ARC,[new i(h,f),o,l,0,y(90),y(90)])),x.push(new s(a.LINE,[new i(c,f),new i(c,m)])),x[x.length-1].meta.closePath=!0,new s(a.ROUNDRECT,[x])},l.prototype.init=function(t,e){this.type=t,this.text=e},l.prototype.typeis=function(t){return this.type==t};var x={};function c(t){for(var e=new Array;""!=t;)if(t.match(/^([ \t\r\n,]+)/))t=t.substr(RegExp.$1.length);else if(t.match(/^([aAcChHlLmMqQsStTvVzZ])/))e[e.length]=new l(x.COMMAND,RegExp.$1),t=t.substr(RegExp.$1.length);else{if(!t.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/))throw new Error("Unrecognized segment command: "+t);e[e.length]=new l(x.NUMBER,parseFloat(RegExp.$1)),t=t.substr(RegExp.$1.length)}return e[e.length]=new l(x.EOD,null),e}function h(t,e,n){arguments.length>0&&this.init(t,e,n)}function p(t,e){arguments.length>0&&this.init("A",t,e)}function d(t,e){arguments.length>0&&this.init("Q",t,e)}function u(t,e){arguments.length>0&&this.init("C",t,e)}function m(t,e){arguments.length>0&&this.init("H",t,e)}function f(t,e){arguments.length>0&&this.init("V",t,e)}function v(t,e){arguments.length>0&&this.init("L",t,e)}function g(t,e){arguments.length>0&&this.init("M",t,e)}function w(t,e){arguments.length>0&&this.init("T",t,e)}function b(t,e){arguments.length>0&&this.init("S",t,e)}function E(t,e,n){arguments.length>0&&this.init(t,e,n)}function P(t,e){arguments.length>0&&this.init("z",t,e)}function k(t,e){arguments.length>0&&this.init("q",t,e)}function I(t,e){arguments.length>0&&this.init("c",t,e)}function M(t,e){arguments.length>0&&this.init("l",t,e)}function D(t,e){arguments.length>0&&this.init("m",t,e)}function N(t,e){arguments.length>0&&this.init("t",t,e)}function C(t,e){arguments.length>0&&this.init("s",t,e)}x.COMMAND=0,x.NUMBER=1,x.EOD=2,x.PARAMS={A:["rx","ry","x-axis-rotation","large-arc-flag","sweep-flag","x","y"],a:["rx","ry","x-axis-rotation","large-arc-flag","sweep-flag","x","y"],C:["x1","y1","x2","y2","x","y"],c:["x1","y1","x2","y2","x","y"],H:["x"],h:["x"],L:["x","y"],l:["x","y"],M:["x","y"],m:["x","y"],Q:["x1","y1","x","y"],q:["x1","y1","x","y"],S:["x2","y2","x","y"],s:["x2","y2","x","y"],T:["x","y"],t:["x","y"],V:["y"],v:["y"],Z:[],z:[]},s.newPath=function(t){for(var e=c(t),n=0,i=e[n],r="BOD",o=[];!i.typeis(x.EOD);){var y,l=new Array;if("BOD"==r){if("M"!=i.text&&"m"!=i.text)throw new Error("Path data must begin with a moveto command");n++,y=x.PARAMS[i.text].length,r=i.text}else i.typeis(x.NUMBER)?y=x.PARAMS[r].length:(n++,y=x.PARAMS[i.text].length,r=i.text);if(!(n+y<e.length))throw new Error("Path data ended before all parameters were found");for(var h=n;h<n+y;h++){var E=e[h];if(!E.typeis(x.NUMBER))throw new Error("Parameter type is not a number: "+r+","+E.text);l[l.length]=E.text}var S,A=o.length,L=0==A?null:o[A-1];switch(r){case"A":S=new p(l,L);break;case"C":S=new u(l,L);break;case"c":S=new I(l,L);break;case"H":S=new m(l,L);break;case"V":S=new f(l,L);break;case"L":S=new v(l,L);break;case"l":S=new M(l,L);break;case"M":S=new g(l,L);break;case"m":S=new D(l,L);break;case"Q":S=new d(l,L);break;case"q":S=new k(l,L);break;case"S":S=new b(l,L);break;case"s":S=new C(l,L);break;case"T":S=new w(l,L);break;case"t":S=new N(l,L);break;case"Z":case"z":S=new P(l,L);break;default:throw new Error("Unsupported segment type: "+r)}o.push(S),i=e[n+=y],"M"==r&&(r="L"),"m"==r&&(r="l")}var R=[];for(h=0;h<o.length;h++){var B=o[h].getIntersectionParams();B&&R.push(B)}return new s(a.PATH,[R])},h.prototype.init=function(t,e,n){this.command=t,this.previous=n,this.points=[];for(var r=0;r<e.length;)this.points.push(new i(e[r],e[r+1])),r+=2},h.prototype.getLastPoint=function(){return this.points[this.points.length-1]},h.prototype.getIntersectionParams=function(){return null},p.prototype=new h,p.prototype.constructor=d,p.superclass=h.prototype,p.prototype.init=function(t,e,n){var i=new Array,r=e.pop(),s=e.pop();i.push(s,r),p.superclass.init.call(this,t,i,n),this.rx=parseFloat(e.shift()),this.ry=parseFloat(e.shift()),this.angle=parseFloat(e.shift()),this.arcFlag=parseFloat(e.shift()),this.sweepFlag=parseFloat(e.shift())},p.prototype.getIntersectionParams=function(){return s.newArc(this.previous.getLastPoint(),this.points[0],this.rx,this.ry,this.angle,this.arcFlag,this.sweepFlag)},d.prototype=new h,d.prototype.constructor=d,d.superclass=h.prototype,d.prototype.getIntersectionParams=function(){return s.newBezier2(this.previous.getLastPoint(),this.points[0],this.points[1])},u.prototype=new h,u.prototype.constructor=u,u.superclass=h.prototype,u.prototype.getLastControlPoint=function(){return this.points[1]},u.prototype.getIntersectionParams=function(){return s.newBezier3(this.previous.getLastPoint(),this.points[0],this.points[1],this.points[2])},m.prototype=new h,m.prototype.constructor=m,m.superclass=h.prototype,m.prototype.init=function(t,e,n){var i=n.getLastPoint(),r=new Array;r.push(e.pop(),i.y),m.superclass.init.call(this,t,r,n)},f.prototype=new h,f.prototype.constructor=f,f.superclass=h.prototype,f.prototype.init=function(t,e,n){var i=n.getLastPoint(),r=new Array;r.push(i.x,e.pop()),f.superclass.init.call(this,t,r,n)},v.prototype=new h,v.prototype.constructor=v,v.superclass=h.prototype,v.prototype.getIntersectionParams=function(){return s.newLine(this.previous.getLastPoint(),this.points[0])},g.prototype=new h,g.prototype.constructor=g,g.superclass=h.prototype,w.prototype=new h,w.prototype.constructor=w,w.superclass=h.prototype,w.prototype.getControlPoint=function(){var t,e=this.previous.getLastPoint();if(this.previous.command.match(/^[QqTt]$/)){var n=this.previous.getControlPoint().subtract(e);t=e.subtract(n)}else t=e;return t},w.prototype.getIntersectionParams=function(){return s.newBezier2(this.previous.getLastPoint(),this.getControlPoint(),this.points[0])},b.prototype=new h,b.prototype.constructor=b,b.superclass=h.prototype,b.prototype.getFirstControlPoint=function(){var t,e=this.previous.getLastPoint();if(this.previous.command.match(/^[SsCc]$/)){var n=this.previous.getLastControlPoint().subtract(e);t=e.subtract(n)}else t=e;return t},b.prototype.getLastControlPoint=function(){return this.points[0]},b.prototype.getIntersectionParams=function(){return s.newBezier3(this.previous.getLastPoint(),this.getFirstControlPoint(),this.points[0],this.points[1])},E.prototype=new h,E.prototype.constructor=E,E.superclass=h.prototype,E.prototype.init=function(t,e,n){var r;this.command=t,this.previous=n,this.points=[],r=this.previous?this.previous.getLastPoint():new i(0,0);for(var s=0;s<e.length;){var a=new i(r.x+e[s],r.y+e[s+1]);this.points.push(a),s+=2}},P.prototype=new E,P.prototype.constructor=P,P.superclass=E.prototype,P.prototype.getLastPoint=function(){for(var t,e=this.previous;e;){if(e.command.match(/^[mMzZ]$/)){t=e.getLastPoint();break}e=e.previous}return t},P.prototype.getIntersectionParams=function(){return s.newLine(this.previous.getLastPoint(),this.getLastPoint())},k.prototype=new E,k.prototype.constructor=k,k.superclass=E.prototype,k.prototype.getControlPoint=function(){return this.points[0]},k.prototype.getIntersectionParams=function(){return s.newBezier2(this.previous.getLastPoint(),this.points[0],this.points[1])},I.prototype=new E,I.prototype.constructor=I,I.superclass=E.prototype,I.prototype.getLastControlPoint=function(){return this.points[1]},I.prototype.getIntersectionParams=function(){return s.newBezier3(this.previous.getLastPoint(),this.points[0],this.points[1],this.points[2])},M.prototype=new E,M.prototype.constructor=M,M.superclass=E.prototype,M.prototype.toString=function(){var t,e;return new Array,t=this.previous?this.previous.getLastPoint():new Point(0,0),e=this.points[0].subtract(t),this.previous.constructor!=this.constuctor&&this.previous.constructor!=D&&(cmd=this.command),cmd+e.toString()},M.prototype.getIntersectionParams=function(){return s.newLine(this.previous.getLastPoint(),this.points[0])},D.prototype=new E,D.prototype.constructor=D,D.superclass=E.prototype,N.prototype=new E,N.prototype.constructor=N,N.superclass=E.prototype,N.prototype.getControlPoint=function(){var t,e=this.previous.getLastPoint();if(this.previous.command.match(/^[QqTt]$/)){var n=this.previous.getControlPoint().subtract(e);t=e.subtract(n)}else t=e;return t},N.prototype.getIntersectionParams=function(){return s.newBezier2(this.previous.getLastPoint(),this.getControlPoint(),this.points[0])},C.prototype=new E,C.prototype.constructor=C,C.superclass=E.prototype,C.prototype.getFirstControlPoint=function(){var t,e=this.previous.getLastPoint();if(this.previous.command.match(/^[SsCc]$/)){var n=this.previous.getLastControlPoint().subtract(e);t=e.subtract(n)}else t=e;return t},C.prototype.getLastControlPoint=function(){return this.points[0]},C.prototype.getIntersectionParams=function(){return s.newBezier3(this.previous.getLastPoint(),this.getFirstControlPoint(),this.points[0],this.points[1])},e.exports=s},{"kld-affine":1}],11:[function(t,e,n){var i=t("../Intersection"),r=t("kld-affine"),s=r.Point2D,a=r.Vector2D,o=t("kld-polynomial").Polynomial;function y(t){var e=1e-15;t.sort((function(t,e){return t-e}));for(var n=1;n<t.length;)Math.abs(t[n]-t[n-1])<e?t.splice(n,1):n++}e.exports={},e.exports.intersectBezier2Bezier2=function(t,e,n,r,a,y){var l,x,c,h,p,d,u,m,f,v,g,w,b,E,P,k,I=new i;l=e.multiply(-2),c=t.add(l.add(n)),l=t.multiply(-2),x=e.multiply(2),h=l.add(x),p=new s(t.x,t.y),l=a.multiply(-2),d=r.add(l.add(y)),l=r.multiply(-2),x=a.multiply(2),u=l.add(x),m=new s(r.x,r.y),0===c.y?(w=(v=c.x*(p.y-m.y))+(g=v-h.x*h.y),b=h.y*h.y,f=new o(c.x*d.y*d.y,2*c.x*u.y*d.y,c.x*u.y*u.y-d.x*b-d.y*v-d.y*g,-u.x*b-u.y*v-u.y*g,(p.x-m.x)*b+(p.y-m.y)*g)):(v=c.x*d.y-c.y*d.x,g=c.x*u.y-u.x*c.y,w=h.x*c.y-h.y*c.x,b=p.y-m.y,E=c.y*(p.x-m.x)-c.x*b,P=-h.y*w+c.y*E,k=w*w,f=new o(v*v,2*v*g,(-d.y*k+c.y*g*g+c.y*v*E+v*P)/c.y,(-u.y*k+c.y*g*E+g*P)/c.y,(b*k+E*P)/c.y));for(var M=f.getRoots(),D=0;D<M.length;D++){var N=M[D];if(0<=N&&N<=1){var C=new o(c.x,h.x,p.x-m.x-N*u.x-N*N*d.x).getRoots(),S=new o(c.y,h.y,p.y-m.y-N*u.y-N*N*d.y).getRoots();if(C.length>0&&S.length>0){var A=1e-4;t:for(var L=0;L<C.length;L++){var R=C[L];if(0<=R&&R<=1)for(var B=0;B<S.length;B++)if(Math.abs(R-S[B])<A){I.points.push(d.multiply(N*N).add(u.multiply(N).add(m)));break t}}}}}return I},e.exports.intersectBezier2Bezier3=function(t,e,n,r,l,x,c){var h,p,d,u,m,f,v,g,w,b,E,P=new i;h=e.multiply(-2),m=t.add(h.add(n)),h=t.multiply(-2),p=e.multiply(2),f=h.add(p),v=new s(t.x,t.y),h=r.multiply(-1),p=l.multiply(3),d=x.multiply(-3),u=h.add(p.add(d.add(c))),g=new a(u.x,u.y),h=r.multiply(3),p=l.multiply(-6),d=x.multiply(3),u=h.add(p.add(d)),w=new a(u.x,u.y),h=r.multiply(-3),p=l.multiply(3),d=h.add(p),b=new a(d.x,d.y),E=new a(r.x,r.y);var k=v.x*v.x,I=v.y*v.y,M=f.x*f.x,D=f.y*f.y,N=m.x*m.x,C=m.y*m.y,S=E.x*E.x,A=E.y*E.y,L=b.x*b.x,R=b.y*b.y,B=w.x*w.x,O=w.y*w.y,T=g.x*g.x,z=g.y*g.y,_=new o(-2*m.x*m.y*g.x*g.y+N*z+C*T,-2*m.x*m.y*w.x*g.y-2*m.x*m.y*w.y*g.x+2*C*w.x*g.x+2*N*w.y*g.y,-2*m.x*b.x*m.y*g.y-2*m.x*m.y*b.y*g.x-2*m.x*m.y*w.x*w.y+2*b.x*C*g.x+C*B+N*(2*b.y*g.y+O),2*v.x*m.x*m.y*g.y+2*v.y*m.x*m.y*g.x+f.x*f.y*m.x*g.y+f.x*f.y*m.y*g.x-2*E.x*m.x*m.y*g.y-2*m.x*E.y*m.y*g.x-2*m.x*b.x*m.y*w.y-2*m.x*m.y*b.y*w.x-2*v.x*C*g.x-2*v.y*N*g.y+2*E.x*C*g.x+2*b.x*C*w.x-D*m.x*g.x-M*m.y*g.y+N*(2*E.y*g.y+2*b.y*w.y),2*v.x*m.x*m.y*w.y+2*v.y*m.x*m.y*w.x+f.x*f.y*m.x*w.y+f.x*f.y*m.y*w.x-2*E.x*m.x*m.y*w.y-2*m.x*E.y*m.y*w.x-2*m.x*b.x*m.y*b.y-2*v.x*C*w.x-2*v.y*N*w.y+2*E.x*C*w.x-D*m.x*w.x-M*m.y*w.y+L*C+N*(2*E.y*w.y+R),2*v.x*m.x*m.y*b.y+2*v.y*m.x*b.x*m.y+f.x*f.y*m.x*b.y+f.x*f.y*b.x*m.y-2*E.x*m.x*m.y*b.y-2*m.x*E.y*b.x*m.y-2*v.x*b.x*C-2*v.y*N*b.y+2*E.x*b.x*C-D*m.x*b.x-M*m.y*b.y+2*N*E.y*b.y,-2*v.x*v.y*m.x*m.y-v.x*f.x*f.y*m.y-v.y*f.x*f.y*m.x+2*v.x*m.x*E.y*m.y+2*v.y*E.x*m.x*m.y+f.x*E.x*f.y*m.y+f.x*f.y*m.x*E.y-2*E.x*m.x*E.y*m.y-2*v.x*E.x*C+v.x*D*m.x+v.y*M*m.y-2*v.y*N*E.y-E.x*D*m.x-M*E.y*m.y+k*C+I*N+S*C+N*A).getRootsInInterval(0,1);y(_);for(var q=0;q<_.length;q++){var F=_[q],X=new o(m.x,f.x,v.x-E.x-F*b.x-F*F*w.x-F*F*F*g.x).getRoots(),$=new o(m.y,f.y,v.y-E.y-F*b.y-F*F*w.y-F*F*F*g.y).getRoots();if(X.length>0&&$.length>0){var Y=1e-4;t:for(var V=0;V<X.length;V++){var U=X[V];if(0<=U&&U<=1)for(var H=0;H<$.length;H++)if(Math.abs(U-$[H])<Y){var j=g.multiply(F*F*F).add(w.multiply(F*F).add(b.multiply(F).add(E)));P.points.push(new s(j.x,j.y));break t}}}}return P},e.exports.intersectBezier2Ellipse=function(t,e,n,r,a,y){var l,x,c,h,p,d=new i;l=e.multiply(-2),c=t.add(l.add(n)),l=t.multiply(-2),x=e.multiply(2),h=l.add(x),p=new s(t.x,t.y);for(var u=a*a,m=y*y,f=new o(m*c.x*c.x+u*c.y*c.y,2*(m*c.x*h.x+u*c.y*h.y),m*(2*c.x*p.x+h.x*h.x)+u*(2*c.y*p.y+h.y*h.y)-2*(m*r.x*c.x+u*r.y*c.y),2*(m*h.x*(p.x-r.x)+u*h.y*(p.y-r.y)),m*(p.x*p.x+r.x*r.x)+u*(p.y*p.y+r.y*r.y)-2*(m*r.x*p.x+u*r.y*p.y)-u*m).getRoots(),v=0;v<f.length;v++){var g=f[v];0<=g&&g<=1&&d.points.push(c.multiply(g*g).add(h.multiply(g).add(p)))}return d},e.exports.intersectBezier2Line=function(t,e,n,r,y){var l,x,c,h,p,d,u,m=r.min(y),f=r.max(y),v=new i;l=e.multiply(-2),c=t.add(l.add(n)),l=t.multiply(-2),x=e.multiply(2),h=l.add(x),p=new s(t.x,t.y),u=new a(r.y-y.y,y.x-r.x),d=r.x*y.y-y.x*r.y,roots=new o(u.dot(c),u.dot(h),u.dot(p)+d).getRoots();for(var g=0;g<roots.length;g++){var w=roots[g];if(0<=w&&w<=1){var b=t.lerp(e,w),E=e.lerp(n,w),P=b.lerp(E,w);r.x==y.x?m.y<=P.y&&P.y<=f.y&&v.appendPoint(P):r.y==y.y?m.x<=P.x&&P.x<=f.x&&v.appendPoint(P):m.x<=P.x&&P.x<=f.x&&m.y<=P.y&&P.y<=f.y&&v.appendPoint(P)}}return v},e.exports.intersectBezier3Bezier3=function(t,e,n,r,l,x,c,h){var p,d,u,m,f,v,g,w,b,E,P,k,I=new i;p=t.multiply(-1),d=e.multiply(3),u=n.multiply(-3),m=p.add(d.add(u.add(r))),f=new a(m.x,m.y),p=t.multiply(3),d=e.multiply(-6),u=n.multiply(3),m=p.add(d.add(u)),v=new a(m.x,m.y),p=t.multiply(-3),d=e.multiply(3),u=p.add(d),g=new a(u.x,u.y),w=new a(t.x,t.y),p=l.multiply(-1),d=x.multiply(3),u=c.multiply(-3),m=p.add(d.add(u.add(h))),b=new a(m.x,m.y),p=l.multiply(3),d=x.multiply(-6),u=c.multiply(3),m=p.add(d.add(u)),E=new a(m.x,m.y),p=l.multiply(-3),d=x.multiply(3),u=p.add(d),P=new a(u.x,u.y),k=new a(l.x,l.y);var M=w.x*w.x,D=w.x*w.x*w.x,N=w.y*w.y,C=w.y*w.y*w.y,S=g.x*g.x,A=g.x*g.x*g.x,L=g.y*g.y,R=g.y*g.y*g.y,B=v.x*v.x,O=v.x*v.x*v.x,T=v.y*v.y,z=v.y*v.y*v.y,_=f.x*f.x,q=f.x*f.x*f.x,F=f.y*f.y,X=f.y*f.y*f.y,$=k.x*k.x,Y=k.x*k.x*k.x,V=k.y*k.y,U=k.y*k.y*k.y,H=P.x*P.x,j=P.x*P.x*P.x,W=P.y*P.y,Z=E.x*E.x,Q=E.x*E.x*E.x,G=E.y*E.y,K=b.x*b.x,J=b.x*b.x*b.x,tt=b.y*b.y,et=b.y*b.y*b.y,nt=new o(-q*et+X*J-3*f.x*F*K*b.y+3*_*f.y*b.x*tt,-6*f.x*E.x*F*b.x*b.y+6*_*f.y*E.y*b.x*b.y+3*E.x*X*K-3*q*E.y*tt-3*f.x*F*E.y*K+3*_*E.x*f.y*tt,-6*P.x*f.x*F*b.x*b.y-6*f.x*E.x*F*E.y*b.x+6*_*E.x*f.y*E.y*b.y+3*P.x*X*K+3*Z*X*b.x+3*P.x*_*f.y*tt-3*f.x*P.y*F*K-3*f.x*Z*F*b.y+_*f.y*b.x*(6*P.y*b.y+3*G)+q*(-P.y*tt-2*G*b.y-b.y*(2*P.y*b.y+G)),g.x*v.y*f.x*f.y*b.x*b.y-g.y*v.x*f.x*f.y*b.x*b.y+6*P.x*E.x*X*b.x+3*g.x*v.x*f.x*f.y*tt+6*w.x*f.x*F*b.x*b.y-3*g.x*v.x*F*b.x*b.y-3*g.y*v.y*f.x*f.y*K-6*w.y*_*f.y*b.x*b.y-6*k.x*f.x*F*b.x*b.y+3*g.y*v.y*_*b.x*b.y-2*v.x*T*f.x*b.x*b.y-6*P.x*f.x*E.x*F*b.y-6*P.x*f.x*F*E.y*b.x-6*f.x*P.y*E.x*F*b.x+6*P.x*_*f.y*E.y*b.y+2*B*v.y*f.y*b.x*b.y+Q*X-3*w.x*X*K+3*w.y*q*tt+3*k.x*X*K+z*f.x*K-O*f.y*tt-3*w.x*_*f.y*tt+3*w.y*f.x*F*K-2*g.x*v.y*_*tt+g.x*v.y*F*K-g.y*v.x*_*tt+2*g.y*v.x*F*K+3*k.x*_*f.y*tt-v.x*T*f.y*K-3*k.y*f.x*F*K+B*v.y*f.x*tt-3*f.x*Z*F*E.y+_*f.y*b.x*(6*k.y*b.y+6*P.y*E.y)+_*E.x*f.y*(6*P.y*b.y+3*G)+q*(-2*P.y*E.y*b.y-k.y*tt-E.y*(2*P.y*b.y+G)-b.y*(2*k.y*b.y+2*P.y*E.y)),6*g.x*v.x*f.x*f.y*E.y*b.y+g.x*v.y*f.x*E.x*f.y*b.y+g.x*v.y*f.x*f.y*E.y*b.x-g.y*v.x*f.x*E.x*f.y*b.y-g.y*v.x*f.x*f.y*E.y*b.x-6*g.y*v.y*f.x*E.x*f.y*b.x-6*w.x*E.x*X*b.x+6*k.x*E.x*X*b.x+6*w.y*q*E.y*b.y+2*z*f.x*E.x*b.x-2*O*f.y*E.y*b.y+6*w.x*f.x*E.x*F*b.y+6*w.x*f.x*F*E.y*b.x+6*w.y*f.x*E.x*F*b.x-3*g.x*v.x*E.x*F*b.y-3*g.x*v.x*F*E.y*b.x+2*g.x*v.y*E.x*F*b.x+4*g.y*v.x*E.x*F*b.x-6*w.x*_*f.y*E.y*b.y-6*w.y*_*E.x*f.y*b.y-6*w.y*_*f.y*E.y*b.x-4*g.x*v.y*_*E.y*b.y-6*k.x*f.x*E.x*F*b.y-6*k.x*f.x*F*E.y*b.x-2*g.y*v.x*_*E.y*b.y+3*g.y*v.y*_*E.x*b.y+3*g.y*v.y*_*E.y*b.x-2*v.x*T*f.x*E.x*b.y-2*v.x*T*f.x*E.y*b.x-2*v.x*T*E.x*f.y*b.x-6*k.y*f.x*E.x*F*b.x-6*P.x*f.x*P.y*F*b.x-6*P.x*f.x*E.x*F*E.y+6*k.x*_*f.y*E.y*b.y+2*B*v.y*f.x*E.y*b.y+2*B*v.y*E.x*f.y*b.y+2*B*v.y*f.y*E.y*b.x+3*P.x*Z*X+3*H*X*b.x-3*f.x*P.y*Z*F-3*H*f.x*F*b.y+_*E.x*f.y*(6*k.y*b.y+6*P.y*E.y)+_*f.y*b.x*(6*k.y*E.y+3*W)+P.x*_*f.y*(6*P.y*b.y+3*G)+q*(-2*k.y*E.y*b.y-b.y*(2*k.y*E.y+W)-P.y*(2*P.y*b.y+G)-E.y*(2*k.y*b.y+2*P.y*E.y)),g.x*P.x*v.y*f.x*f.y*b.y+g.x*v.y*f.x*P.y*f.y*b.x+g.x*v.y*f.x*E.x*f.y*E.y-g.y*v.x*P.x*f.x*f.y*b.y-g.y*v.x*f.x*P.y*f.y*b.x-g.y*v.x*f.x*E.x*f.y*E.y-6*g.y*P.x*v.y*f.x*f.y*b.x-6*w.x*P.x*X*b.x+6*k.x*P.x*X*b.x+2*P.x*z*f.x*b.x+6*w.x*P.x*f.x*F*b.y+6*w.x*f.x*P.y*F*b.x+6*w.x*f.x*E.x*F*E.y+6*w.y*P.x*f.x*F*b.x-3*g.x*v.x*P.x*F*b.y-3*g.x*v.x*P.y*F*b.x-3*g.x*v.x*E.x*F*E.y+2*g.x*P.x*v.y*F*b.x+4*g.y*v.x*P.x*F*b.x-6*w.y*P.x*_*f.y*b.y-6*w.y*_*P.y*f.y*b.x-6*w.y*_*E.x*f.y*E.y-6*k.x*P.x*f.x*F*b.y-6*k.x*f.x*P.y*F*b.x-6*k.x*f.x*E.x*F*E.y+3*g.y*P.x*v.y*_*b.y-3*g.y*v.y*f.x*Z*f.y+3*g.y*v.y*_*P.y*b.x+3*g.y*v.y*_*E.x*E.y-2*v.x*P.x*T*f.x*b.y-2*v.x*P.x*T*f.y*b.x-2*v.x*T*f.x*P.y*b.x-2*v.x*T*f.x*E.x*E.y-6*k.y*P.x*f.x*F*b.x-6*P.x*f.x*P.y*E.x*F+6*k.y*_*P.y*f.y*b.x+2*B*P.x*v.y*f.y*b.y+2*B*v.y*P.y*f.y*b.x+2*B*v.y*E.x*f.y*E.y-3*w.x*Z*X+3*k.x*Z*X+3*H*E.x*X+z*f.x*Z+3*w.y*f.x*Z*F+g.x*v.y*Z*F+2*g.y*v.x*Z*F-v.x*T*Z*f.y-3*k.y*f.x*Z*F-3*H*f.x*F*E.y+B*v.y*f.x*(2*P.y*b.y+G)+g.x*v.x*f.x*f.y*(6*P.y*b.y+3*G)+P.x*_*f.y*(6*k.y*b.y+6*P.y*E.y)+O*f.y*(-2*P.y*b.y-G)+w.y*q*(6*P.y*b.y+3*G)+g.y*v.x*_*(-2*P.y*b.y-G)+g.x*v.y*_*(-4*P.y*b.y-2*G)+w.x*_*f.y*(-6*P.y*b.y-3*G)+_*E.x*f.y*(6*k.y*E.y+3*W)+k.x*_*f.y*(6*P.y*b.y+3*G)+q*(-2*k.y*P.y*b.y-E.y*(2*k.y*E.y+W)-k.y*(2*P.y*b.y+G)-P.y*(2*k.y*b.y+2*P.y*E.y)),-w.x*g.x*v.y*f.x*f.y*b.y+w.x*g.y*v.x*f.x*f.y*b.y+6*w.x*g.y*v.y*f.x*f.y*b.x-6*w.y*g.x*v.x*f.x*f.y*b.y-w.y*g.x*v.y*f.x*f.y*b.x+w.y*g.y*v.x*f.x*f.y*b.x+g.x*g.y*v.x*v.y*f.x*b.y-g.x*g.y*v.x*v.y*f.y*b.x+g.x*k.x*v.y*f.x*f.y*b.y+g.x*k.y*v.y*f.x*f.y*b.x+g.x*P.x*v.y*f.x*f.y*E.y+g.x*v.y*f.x*P.y*E.x*f.y-k.x*g.y*v.x*f.x*f.y*b.y-6*k.x*g.y*v.y*f.x*f.y*b.x-g.y*v.x*k.y*f.x*f.y*b.x-g.y*v.x*P.x*f.x*f.y*E.y-g.y*v.x*f.x*P.y*E.x*f.y-6*g.y*P.x*v.y*f.x*E.x*f.y-6*w.x*k.x*X*b.x-6*w.x*P.x*E.x*X-2*w.x*z*f.x*b.x+6*k.x*P.x*E.x*X+2*k.x*z*f.x*b.x+2*P.x*z*f.x*E.x+2*w.y*O*f.y*b.y-6*w.x*w.y*f.x*F*b.x+3*w.x*g.x*v.x*F*b.y-2*w.x*g.x*v.y*F*b.x-4*w.x*g.y*v.x*F*b.x+3*w.y*g.x*v.x*F*b.x+6*w.x*w.y*_*f.y*b.y+6*w.x*k.x*f.x*F*b.y-3*w.x*g.y*v.y*_*b.y+2*w.x*v.x*T*f.x*b.y+2*w.x*v.x*T*f.y*b.x+6*w.x*k.y*f.x*F*b.x+6*w.x*P.x*f.x*F*E.y+6*w.x*f.x*P.y*E.x*F+4*w.y*g.x*v.y*_*b.y+6*w.y*k.x*f.x*F*b.x+2*w.y*g.y*v.x*_*b.y-3*w.y*g.y*v.y*_*b.x+2*w.y*v.x*T*f.x*b.x+6*w.y*P.x*f.x*E.x*F-3*g.x*k.x*v.x*F*b.y+2*g.x*k.x*v.y*F*b.x+g.x*g.y*T*f.x*b.x-3*g.x*v.x*k.y*F*b.x-3*g.x*v.x*P.x*F*E.y-3*g.x*v.x*P.y*E.x*F+2*g.x*P.x*v.y*E.x*F+4*k.x*g.y*v.x*F*b.x+4*g.y*v.x*P.x*E.x*F-2*w.x*B*v.y*f.y*b.y-6*w.y*k.x*_*f.y*b.y-6*w.y*k.y*_*f.y*b.x-6*w.y*P.x*_*f.y*E.y-2*w.y*B*v.y*f.x*b.y-2*w.y*B*v.y*f.y*b.x-6*w.y*_*P.y*E.x*f.y-g.x*g.y*B*f.y*b.y-2*g.x*L*f.x*f.y*b.x+3*k.x*g.y*v.y*_*b.y-2*k.x*v.x*T*f.x*b.y-2*k.x*v.x*T*f.y*b.x-6*k.x*k.y*f.x*F*b.x-6*k.x*P.x*f.x*F*E.y-6*k.x*f.x*P.y*E.x*F+3*g.y*k.y*v.y*_*b.x+3*g.y*P.x*v.y*_*E.y+3*g.y*v.y*_*P.y*E.x-2*v.x*k.y*T*f.x*b.x-2*v.x*P.x*T*f.x*E.y-2*v.x*P.x*T*E.x*f.y-2*v.x*T*f.x*P.y*E.x-6*k.y*P.x*f.x*E.x*F-L*v.x*v.y*f.x*b.x+2*k.x*B*v.y*f.y*b.y+6*k.y*_*P.y*E.x*f.y+2*S*g.y*f.x*f.y*b.y+S*v.x*v.y*f.y*b.y+2*B*k.y*v.y*f.y*b.x+2*B*P.x*v.y*f.y*E.y+2*B*v.y*P.y*E.x*f.y+j*X+3*M*X*b.x-3*N*q*b.y+3*$*X*b.x+R*_*b.x-A*F*b.y-g.x*L*_*b.y+S*g.y*F*b.x-3*M*f.x*F*b.y+3*N*_*f.y*b.x-S*T*f.x*b.y+L*B*f.y*b.x-3*H*f.x*P.y*F-3*$*f.x*F*b.y+3*V*_*f.y*b.x+g.x*v.x*f.x*f.y*(6*k.y*b.y+6*P.y*E.y)+O*f.y*(-2*k.y*b.y-2*P.y*E.y)+w.y*q*(6*k.y*b.y+6*P.y*E.y)+g.y*v.x*_*(-2*k.y*b.y-2*P.y*E.y)+B*v.y*f.x*(2*k.y*b.y+2*P.y*E.y)+g.x*v.y*_*(-4*k.y*b.y-4*P.y*E.y)+w.x*_*f.y*(-6*k.y*b.y-6*P.y*E.y)+k.x*_*f.y*(6*k.y*b.y+6*P.y*E.y)+P.x*_*f.y*(6*k.y*E.y+3*W)+q*(-2*k.y*P.y*E.y-V*b.y-P.y*(2*k.y*E.y+W)-k.y*(2*k.y*b.y+2*P.y*E.y)),-w.x*g.x*v.y*f.x*f.y*E.y+w.x*g.y*v.x*f.x*f.y*E.y+6*w.x*g.y*v.y*f.x*E.x*f.y-6*w.y*g.x*v.x*f.x*f.y*E.y-w.y*g.x*v.y*f.x*E.x*f.y+w.y*g.y*v.x*f.x*E.x*f.y+g.x*g.y*v.x*v.y*f.x*E.y-g.x*g.y*v.x*v.y*E.x*f.y+g.x*k.x*v.y*f.x*f.y*E.y+g.x*k.y*v.y*f.x*E.x*f.y+g.x*P.x*v.y*f.x*P.y*f.y-k.x*g.y*v.x*f.x*f.y*E.y-6*k.x*g.y*v.y*f.x*E.x*f.y-g.y*v.x*k.y*f.x*E.x*f.y-g.y*v.x*P.x*f.x*P.y*f.y-6*w.x*k.x*E.x*X-2*w.x*z*f.x*E.x+2*k.x*z*f.x*E.x+2*w.y*O*f.y*E.y-6*w.x*w.y*f.x*E.x*F+3*w.x*g.x*v.x*F*E.y-2*w.x*g.x*v.y*E.x*F-4*w.x*g.y*v.x*E.x*F+3*w.y*g.x*v.x*E.x*F+6*w.x*w.y*_*f.y*E.y+6*w.x*k.x*f.x*F*E.y-3*w.x*g.y*v.y*_*E.y+2*w.x*v.x*T*f.x*E.y+2*w.x*v.x*T*E.x*f.y+6*w.x*k.y*f.x*E.x*F+6*w.x*P.x*f.x*P.y*F+4*w.y*g.x*v.y*_*E.y+6*w.y*k.x*f.x*E.x*F+2*w.y*g.y*v.x*_*E.y-3*w.y*g.y*v.y*_*E.x+2*w.y*v.x*T*f.x*E.x-3*g.x*k.x*v.x*F*E.y+2*g.x*k.x*v.y*E.x*F+g.x*g.y*T*f.x*E.x-3*g.x*v.x*k.y*E.x*F-3*g.x*v.x*P.x*P.y*F+4*k.x*g.y*v.x*E.x*F-2*w.x*B*v.y*f.y*E.y-6*w.y*k.x*_*f.y*E.y-6*w.y*k.y*_*E.x*f.y-6*w.y*P.x*_*P.y*f.y-2*w.y*B*v.y*f.x*E.y-2*w.y*B*v.y*E.x*f.y-g.x*g.y*B*f.y*E.y-2*g.x*L*f.x*E.x*f.y+3*k.x*g.y*v.y*_*E.y-2*k.x*v.x*T*f.x*E.y-2*k.x*v.x*T*E.x*f.y-6*k.x*k.y*f.x*E.x*F-6*k.x*P.x*f.x*P.y*F+3*g.y*k.y*v.y*_*E.x+3*g.y*P.x*v.y*_*P.y-2*v.x*k.y*T*f.x*E.x-2*v.x*P.x*T*f.x*P.y-L*v.x*v.y*f.x*E.x+2*k.x*B*v.y*f.y*E.y-3*g.y*H*v.y*f.x*f.y+6*k.y*P.x*_*P.y*f.y+2*S*g.y*f.x*f.y*E.y+S*v.x*v.y*f.y*E.y+2*B*k.y*v.y*E.x*f.y+2*B*P.x*v.y*P.y*f.y-3*w.x*H*X+3*k.x*H*X+3*M*E.x*X-3*N*q*E.y+3*$*E.x*X+H*z*f.x+R*_*E.x-A*F*E.y+3*w.y*H*f.x*F-g.x*L*_*E.y+g.x*H*v.y*F+2*g.y*v.x*H*F+S*g.y*E.x*F-v.x*H*T*f.y-3*k.y*H*f.x*F-3*M*f.x*F*E.y+3*N*_*E.x*f.y-S*T*f.x*E.y+L*B*E.x*f.y-3*$*f.x*F*E.y+3*V*_*E.x*f.y+B*v.y*f.x*(2*k.y*E.y+W)+g.x*v.x*f.x*f.y*(6*k.y*E.y+3*W)+O*f.y*(-2*k.y*E.y-W)+w.y*q*(6*k.y*E.y+3*W)+g.y*v.x*_*(-2*k.y*E.y-W)+g.x*v.y*_*(-4*k.y*E.y-2*W)+w.x*_*f.y*(-6*k.y*E.y-3*W)+k.x*_*f.y*(6*k.y*E.y+3*W)+q*(-2*k.y*W-V*E.y-k.y*(2*k.y*E.y+W)),-w.x*g.x*v.y*f.x*P.y*f.y+w.x*g.y*v.x*f.x*P.y*f.y+6*w.x*g.y*P.x*v.y*f.x*f.y-6*w.y*g.x*v.x*f.x*P.y*f.y-w.y*g.x*P.x*v.y*f.x*f.y+w.y*g.y*v.x*P.x*f.x*f.y-g.x*g.y*v.x*P.x*v.y*f.y+g.x*g.y*v.x*v.y*f.x*P.y+g.x*k.x*v.y*f.x*P.y*f.y+6*g.x*v.x*k.y*f.x*P.y*f.y+g.x*k.y*P.x*v.y*f.x*f.y-k.x*g.y*v.x*f.x*P.y*f.y-6*k.x*g.y*P.x*v.y*f.x*f.y-g.y*v.x*k.y*P.x*f.x*f.y-6*w.x*k.x*P.x*X-2*w.x*P.x*z*f.x+6*w.y*k.y*q*P.y+2*k.x*P.x*z*f.x+2*w.y*O*P.y*f.y-2*O*k.y*P.y*f.y-6*w.x*w.y*P.x*f.x*F+3*w.x*g.x*v.x*P.y*F-2*w.x*g.x*P.x*v.y*F-4*w.x*g.y*v.x*P.x*F+3*w.y*g.x*v.x*P.x*F+6*w.x*w.y*_*P.y*f.y+6*w.x*k.x*f.x*P.y*F-3*w.x*g.y*v.y*_*P.y+2*w.x*v.x*P.x*T*f.y+2*w.x*v.x*T*f.x*P.y+6*w.x*k.y*P.x*f.x*F+4*w.y*g.x*v.y*_*P.y+6*w.y*k.x*P.x*f.x*F+2*w.y*g.y*v.x*_*P.y-3*w.y*g.y*P.x*v.y*_+2*w.y*v.x*P.x*T*f.x-3*g.x*k.x*v.x*P.y*F+2*g.x*k.x*P.x*v.y*F+g.x*g.y*P.x*T*f.x-3*g.x*v.x*k.y*P.x*F+4*k.x*g.y*v.x*P.x*F-6*w.x*k.y*_*P.y*f.y-2*w.x*B*v.y*P.y*f.y-6*w.y*k.x*_*P.y*f.y-6*w.y*k.y*P.x*_*f.y-2*w.y*B*P.x*v.y*f.y-2*w.y*B*v.y*f.x*P.y-g.x*g.y*B*P.y*f.y-4*g.x*k.y*v.y*_*P.y-2*g.x*L*P.x*f.x*f.y+3*k.x*g.y*v.y*_*P.y-2*k.x*v.x*P.x*T*f.y-2*k.x*v.x*T*f.x*P.y-6*k.x*k.y*P.x*f.x*F-2*g.y*v.x*k.y*_*P.y+3*g.y*k.y*P.x*v.y*_-2*v.x*k.y*P.x*T*f.x-L*v.x*P.x*v.y*f.x+6*k.x*k.y*_*P.y*f.y+2*k.x*B*v.y*P.y*f.y+2*S*g.y*f.x*P.y*f.y+S*v.x*v.y*P.y*f.y+2*B*k.y*P.x*v.y*f.y+2*B*k.y*v.y*f.x*P.y+3*M*P.x*X-3*N*q*P.y+3*$*P.x*X+R*P.x*_-A*P.y*F-3*V*q*P.y-g.x*L*_*P.y+S*g.y*P.x*F-3*M*f.x*P.y*F+3*N*P.x*_*f.y-S*T*f.x*P.y+L*B*P.x*f.y-3*$*f.x*P.y*F+3*V*P.x*_*f.y,w.x*w.y*g.x*v.y*f.x*f.y-w.x*w.y*g.y*v.x*f.x*f.y+w.x*g.x*g.y*v.x*v.y*f.y-w.y*g.x*g.y*v.x*v.y*f.x-w.x*g.x*k.y*v.y*f.x*f.y+6*w.x*k.x*g.y*v.y*f.x*f.y+w.x*g.y*v.x*k.y*f.x*f.y-w.y*g.x*k.x*v.y*f.x*f.y-6*w.y*g.x*v.x*k.y*f.x*f.y+w.y*k.x*g.y*v.x*f.x*f.y-g.x*k.x*g.y*v.x*v.y*f.y+g.x*g.y*v.x*k.y*v.y*f.x+g.x*k.x*k.y*v.y*f.x*f.y-k.x*g.y*v.x*k.y*f.x*f.y-2*w.x*k.x*z*f.x+2*w.y*O*k.y*f.y-3*w.x*w.y*g.x*v.x*F-6*w.x*w.y*k.x*f.x*F+3*w.x*w.y*g.y*v.y*_-2*w.x*w.y*v.x*T*f.x-2*w.x*g.x*k.x*v.y*F-w.x*g.x*g.y*T*f.x+3*w.x*g.x*v.x*k.y*F-4*w.x*k.x*g.y*v.x*F+3*w.y*g.x*k.x*v.x*F+6*w.x*w.y*k.y*_*f.y+2*w.x*w.y*B*v.y*f.y+2*w.x*g.x*L*f.x*f.y+2*w.x*k.x*v.x*T*f.y+6*w.x*k.x*k.y*f.x*F-3*w.x*g.y*k.y*v.y*_+2*w.x*v.x*k.y*T*f.x+w.x*L*v.x*v.y*f.x+w.y*g.x*g.y*B*f.y+4*w.y*g.x*k.y*v.y*_-3*w.y*k.x*g.y*v.y*_+2*w.y*k.x*v.x*T*f.x+2*w.y*g.y*v.x*k.y*_+g.x*k.x*g.y*T*f.x-3*g.x*k.x*v.x*k.y*F-2*w.x*B*k.y*v.y*f.y-6*w.y*k.x*k.y*_*f.y-2*w.y*k.x*B*v.y*f.y-2*w.y*S*g.y*f.x*f.y-w.y*S*v.x*v.y*f.y-2*w.y*B*k.y*v.y*f.x-2*g.x*k.x*L*f.x*f.y-g.x*g.y*B*k.y*f.y+3*k.x*g.y*k.y*v.y*_-2*k.x*v.x*k.y*T*f.x-k.x*L*v.x*v.y*f.x+3*N*g.x*v.x*f.x*f.y+3*g.x*v.x*V*f.x*f.y+2*k.x*B*k.y*v.y*f.y-3*M*g.y*v.y*f.x*f.y+2*S*g.y*k.y*f.x*f.y+S*v.x*k.y*v.y*f.y-3*$*g.y*v.y*f.x*f.y-D*X+C*q+Y*X-U*q-3*w.x*$*X-w.x*R*_+3*M*k.x*X+w.y*A*F+3*w.y*V*q+k.x*R*_+M*z*f.x-3*N*k.y*q-N*O*f.y+$*z*f.x-A*k.y*F-O*V*f.y-w.x*S*g.y*F+w.y*g.x*L*_-3*w.x*N*_*f.y-w.x*L*B*f.y+w.y*S*T*f.x-g.x*L*k.y*_+3*M*w.y*f.x*F+M*g.x*v.y*F+2*M*g.y*v.x*F-2*N*g.x*v.y*_-N*g.y*v.x*_+S*k.x*g.y*F-3*w.x*V*_*f.y+3*w.y*$*f.x*F+g.x*$*v.y*F-2*g.x*V*v.y*_+k.x*L*B*f.y-g.y*v.x*V*_-M*v.x*T*f.y-3*M*k.y*f.x*F+3*N*k.x*_*f.y+N*B*v.y*f.x-S*k.y*T*f.x+2*$*g.y*v.x*F+3*k.x*V*_*f.y-$*v.x*T*f.y-3*$*k.y*f.x*F+B*V*v.y*f.x).getRootsInInterval(0,1);y(nt);for(var it=0;it<nt.length;it++){var rt=nt[it],st=new o(f.x,v.x,g.x,w.x-k.x-rt*P.x-rt*rt*E.x-rt*rt*rt*b.x).getRoots(),at=new o(f.y,v.y,g.y,w.y-k.y-rt*P.y-rt*rt*E.y-rt*rt*rt*b.y).getRoots();if(st.length>0&&at.length>0){var ot=1e-4;t:for(var yt=0;yt<st.length;yt++){var lt=st[yt];if(0<=lt&&lt<=1)for(var xt=0;xt<at.length;xt++)if(Math.abs(lt-at[xt])<ot){var ct=b.multiply(rt*rt*rt).add(E.multiply(rt*rt).add(P.multiply(rt).add(k)));I.points.push(new s(ct.x,ct.y));break t}}}}return I},e.exports.intersectBezier3Ellipse=function(t,e,n,r,l,x,c){var h,p,d,u,m,f,v,g,w=new i;h=t.multiply(-1),p=e.multiply(3),d=n.multiply(-3),u=h.add(p.add(d.add(r))),m=new a(u.x,u.y),h=t.multiply(3),p=e.multiply(-6),d=n.multiply(3),u=h.add(p.add(d)),f=new a(u.x,u.y),h=t.multiply(-3),p=e.multiply(3),d=h.add(p),v=new a(d.x,d.y),g=new a(t.x,t.y);var b=x*x,E=c*c,P=new o(m.x*m.x*E+m.y*m.y*b,2*(m.x*f.x*E+m.y*f.y*b),2*(m.x*v.x*E+m.y*v.y*b)+f.x*f.x*E+f.y*f.y*b,2*m.x*E*(g.x-l.x)+2*m.y*b*(g.y-l.y)+2*(f.x*v.x*E+f.y*v.y*b),2*f.x*E*(g.x-l.x)+2*f.y*b*(g.y-l.y)+v.x*v.x*E+v.y*v.y*b,2*v.x*E*(g.x-l.x)+2*v.y*b*(g.y-l.y),g.x*g.x*E-2*g.y*l.y*b-2*g.x*l.x*E+g.y*g.y*b+l.x*l.x*E+l.y*l.y*b-b*E).getRootsInInterval(0,1);y(P);for(var k=0;k<P.length;k++){var I=P[k],M=m.multiply(I*I*I).add(f.multiply(I*I).add(v.multiply(I).add(g)));w.points.push(new s(M.x,M.y))}return w},e.exports.intersectBezier3Line=function(t,e,n,r,s,y){var l,x,c,h,p,d,u,m,f,v,g=s.min(y),w=s.max(y),b=new i;l=t.multiply(-1),x=e.multiply(3),c=n.multiply(-3),h=l.add(x.add(c.add(r))),p=new a(h.x,h.y),l=t.multiply(3),x=e.multiply(-6),c=n.multiply(3),h=l.add(x.add(c)),d=new a(h.x,h.y),l=t.multiply(-3),x=e.multiply(3),c=l.add(x),u=new a(c.x,c.y),m=new a(t.x,t.y),v=new a(s.y-y.y,y.x-s.x),f=s.x*y.y-y.x*s.y;for(var E=new o(v.dot(p),v.dot(d),v.dot(u),v.dot(m)+f).getRoots(),P=0;P<E.length;P++){var k=E[P];if(0<=k&&k<=1){var I=t.lerp(e,k),M=e.lerp(n,k),D=n.lerp(r,k),N=I.lerp(M,k),C=M.lerp(D,k),S=N.lerp(C,k);s.x==y.x?g.y<=S.y&&S.y<=w.y&&b.appendPoint(S):s.y==y.y?g.x<=S.x&&S.x<=w.x&&b.appendPoint(S):g.x<=S.x&&S.x<=w.x&&g.y<=S.y&&S.y<=w.y&&b.appendPoint(S)}}return b}},{"../Intersection":9,"kld-affine":1,"kld-polynomial":5}],12:[function(t,e,n){var i=t("kld-affine").Point2D,r=t("kld-affine").Vector2D,s=t("kld-affine").Matrix2D,a=t("kld-polynomial").Polynomial,o=t("./IntersectionParams"),y=t("./Intersection"),l=t("./functions/bezier"),x=o.TYPE;function c(t,e){var n=t[0]*e[1]-e[0]*t[1],i=t[0]*e[2]-e[0]*t[2],r=t[0]*e[3]-e[0]*t[3],s=t[0]*e[4]-e[0]*t[4],o=t[0]*e[5]-e[0]*t[5],y=t[1]*e[2]-e[1]*t[2],l=t[1]*e[4]-e[1]*t[4],x=t[1]*e[5]-e[1]*t[5],c=t[2]*e[3]-e[2]*t[3],h=t[3]*e[4]-e[3]*t[4],p=t[3]*e[5]-e[3]*t[5],d=x+h,u=l-c;return new a(n*y-i*i,n*u+r*y-2*i*s,n*d+r*u-s*s-2*i*o,n*p+r*d-2*s*o,r*p-o*o)}function h(t,e,n,i,a,o,y,l){if(0===t.points.length)return t;if(l&&!l.isIdentity())var x=l.inverse();var c=[],h=new r(1,0),p=2*Math.PI,d=y<0,u=Math.abs(y)>Math.PI,m=(new s).scaleNonUniform(1,i/n).rotate(o),f=(new s).scaleNonUniform(1,i/n).rotate(o+y);o=(h.angleBetween(h.transform(m))+p)%p,y=h.transform(m).angleBetween(h.transform(f)),y=(u?p-Math.abs(y):Math.abs(y))*(d?-1:1);for(var v,g,w=(new s).rotate(a).multiply(m),b=0;b<t.points.length;b++)v=t.points[b],g=h.transform(w).angleBetween(r.fromPoints(e,x?v.transform(x):v)),y>=0?(g=(g+2*p)%p)<=y&&c.push(v):(g=(g-2*p)%p)>=y&&c.push(v);return t.points=c,t}function p(t,e){if(0!==t.length&&0!==e.length)for(var n,i=function(t,e){return t<e.x&&(t=e.x),t<e.y&&(t=e.y),t},r=t.reduce(i,0),s=100*(r=e.reduce(i,r))*1e-15*Math.SQRT2,a=0;a<t.length;){for(n=0;n<e.length;n++)if(t[a].distanceFrom(e[n])<=s){t.splice(a,1);break}n==e.length&&a++}}var d={intersectPathShape:function(t,e,n,i){for(var r,s,a,o=new y,l=t.params[0],x=0;x<l.length;x++)a=m(l[x],e,n,i),r||(r=a),s&&(p(s.points,a.points),o.appendPoints(s.points)),s=a;return s&&o.appendPoints(s.points),o},intersectLinesShape:function(t,e,n,i,r){var s,a,l=o.TYPE,x=t.params[0],c=new o(l.LINE,[0,0]),h=new y,d=function(t,r){c.params[0]=x[t],c.params[1]=x[r],p((s=m(c,e,n,i)).points,[x[r]]),h.appendPoints(s.points)};for(a=0;a<x.length-1;a++)d(a,a+1);return(void 0!==r&&r||t.type===l.RECT||t.type===l.POLYGON)&&d(x.length-1,0),h},intersectArcShape:function(t,e,n,r){n=n||s.IDENTITY,r=r||s.IDENTITY;var a=t.params[0],y=t.params[1],l=t.params[2],x=t.params[3],c=t.params[4],p=t.params[5];return n.isIdentity()&&0===x||(n=n.multiply(s.IDENTITY.translate(a.x,a.y).rotate(x)),a=new i(0,0),x=0),h(m(o.newEllipse(a,y,l),e,n,r),a,y,l,x,c,p,n)},intersectEllipseEllipse:function(t,e,n,r,s,o){var l,x=[n*n,0,e*e,-2*n*n*t.x,-2*e*e*t.y,n*n*t.x*t.x+e*e*t.y*t.y-e*e*n*n],h=[o*o,0,s*s,-2*o*o*r.x,-2*s*s*r.y,o*o*r.x*r.x+s*s*r.y*r.y-s*s*o*o],p=c(x,h),d=p.getRoots(),u=.001,m=(x[0]*x[0]+2*x[1]*x[1]+x[2]*x[2])*u,f=(h[0]*h[0]+2*h[1]*h[1]+h[2]*h[2])*u,v=new y,g=function(t,e,n){return Math.max(e,Math.min(n,t))};for(l=0;l<d.length;l++)d[l]=g(d[l],t.y-n,t.y+n),d[l]=g(d[l],r.y-o,r.y+o);d.sort((function(t,e){return t-e}));for(var w=[],b=0;b<d.length;b++){var E=new a(x[0],x[3]+d[b]*x[1],x[5]+d[b]*(x[4]+d[b]*x[2])),P=1e-15;Math.abs(E.coefs[0])<10*P*Math.abs(E.coefs[2])&&(E.coefs[0]=0);var k=E.getRoots();w.push(0);for(var I=0;I<k.length;I++){var M=(x[0]*k[I]+x[1]*d[b]+x[3])*k[I]+(x[2]*d[b]+x[4])*d[b]+x[5];Math.abs(M)<m&&(M=(h[0]*k[I]+h[1]*d[b]+h[3])*k[I]+(h[2]*d[b]+h[4])*d[b]+h[5],Math.abs(M)<f&&(v.appendPoint(new i(k[I],d[b])),w[b]+=1))}}if(v.points.length<=0)return v;var D=v.points;if(8==D.length)(D=D.splice(0,6)).splice(2,2);else if(7==D.length)(D=D.splice(0,6)).splice(2,2),D.splice(w.indexOf(1),1);else if(6==D.length)D.splice(2,2),w.indexOf(0)>-1?D[0].distanceFrom(D[1])<D[2].distanceFrom(D[3])?D.splice(0,1):D.splice(2,1):w[0]==w[3]&&D.splice(1,2);else if(4==D.length)(2==d.length||4==d.length&&(2==w[0]&&2==w[1]||2==w[2]&&2==w[3]))&&D.splice(2,2);else if((3==D.length||5==D.length)&&(l=w.indexOf(2))>-1){3==D.length&&(l%=2);var N,C,S,A=l+(l%2?-1:2);N=D[l].distanceFrom(D[l+1]),C=D[l].distanceFrom(D[A]),S=D[l+1].distanceFrom(D[A]),N<C&&N<S?D.splice(l,1):D.splice(A,1)}var L=p.zeroErrorEstimate();for(L*=100*Math.SQRT2,l=0;l<D.length-1;)D[l].distanceFrom(D[l+1])<L?D.splice(l+1,1):l++;return v.points=D,v},intersectEllipseLine:function(t,e,n,i,s){var a,o=new r(i.x,i.y),l=r.fromPoints(i,s),x=new r(t.x,t.y),c=o.subtract(x),h=new r(l.x/(e*e),l.y/(n*n)),p=new r(c.x/(e*e),c.y/(n*n)),d=l.dot(h),u=l.dot(p),m=u*u-d*(t=c.dot(p)-1),f=1e-15,v=10*Math.max(Math.abs(d),Math.abs(u),Math.abs(t))*f;if(Math.abs(m)<v&&(m=0),m<0)a=new y("Outside");else if(m>0){var g=Math.sqrt(m),w=(-u-g)/d,b=(-u+g)/d;b=b>1?b-f:b<0?b+f:b,((w=w>1?w-f:w<0?w+f:w)<0||1<w)&&(b<0||1<b)?a=new y(w<0&&b<0||w>1&&b>1?"Outside":"Inside"):(a=new y,0<=w&&w<=1&&a.appendPoint(i.lerp(s,w)),0<=b&&b<=1&&a.appendPoint(i.lerp(s,b)))}else{var E=-u/d;0<=E&&E<=1?(a=new y).appendPoint(i.lerp(s,E)):a=new y("Outside")}return a},intersectLineLine:function(t,e,n,r){var s,a=(r.x-n.x)*(t.y-n.y)-(r.y-n.y)*(t.x-n.x),o=(e.x-t.x)*(t.y-n.y)-(e.y-t.y)*(t.x-n.x),l=(r.y-n.y)*(e.x-t.x)-(r.x-n.x)*(e.y-t.y);if(0!==l){var x=a/l,c=o/l;0<=x&&x<=1&&0<=c&&c<=1?(s=new y).points.push(new i(t.x+x*(e.x-t.x),t.y+x*(e.y-t.y))):s=new y}else s=new y(0===a||0===o?"Coincident":"Parallel");return s},intersectRayRay:function(t,e,n,r){var s,a=(r.x-n.x)*(t.y-n.y)-(r.y-n.y)*(t.x-n.x),o=(e.x-t.x)*(t.y-n.y)-(e.y-t.y)*(t.x-n.x),l=(r.y-n.y)*(e.x-t.x)-(r.x-n.x)*(e.y-t.y);if(0!==l){var x=a/l;(s=new y).points.push(new i(t.x+x*(e.x-t.x),t.y+x*(e.y-t.y)))}else s=new y(0===a||0===o?"Coincident":"Parallel");return s}},u={};function m(t,e,n,r){var a,o,l=t,c=e;if(null!==l&&null!==c)if(o=u[l.type])a=o(l,c,n,r);else if(o=u[c.type])a=o(c,l,r,n);else{var h,p,m,f,v;l.type===x.CIRCLE?(p=[l.params[0],l.params[1],l.params[1]],f=x.ELLIPSE):(p=l.params.slice(),f=l.type),c.type===x.CIRCLE?(m=[c.params[0],c.params[1],c.params[1]],v=x.ELLIPSE):(m=c.params.slice(),v=c.type);var g,w=1,b=n instanceof s&&r instanceof s;if(b)if(f===x.ELLIPSE&&v===x.ELLIPSE){var E,P,k,I=p[0],M=p[1],D=p[2],N=m[0],C=m[1],S=m[2];n=n.multiply(s.IDENTITY.translate(I.x,I.y).scaleNonUniform(M/w,D/w)),I=new i(0,0),M=D=w,r=r.multiply(s.IDENTITY.translate(N.x,N.y).scaleNonUniform(C,S)),N=new i(0,0),C=S=1,E=(k=n.inverse().multiply(r).getDecomposition()).rotation.inverse().multiply(k.translation.inverse()),C=(P=k.scale).a,S=P.d,I=I.transform(E),g=n.multiply(E.inverse()),p[0]=I,p[1]=M,p[2]=D,m[0]=N,m[1]=C,m[2]=S}else{var A,L=function(t,e,n){var i=function(t){e[t]=e[t].transform(n)};if(t===x.LINE)i(0),i(1);else if(t===x.BEZIER2)i(0),i(1),i(2);else{if(t!==x.BEZIER3)throw new Error("Unknown shape: "+t);i(0),i(1),i(2),i(3)}};v===x.ELLIPSE&&(A=m,m=p,p=A,A=v,v=f,f=A,A=r,r=n,n=A),f===x.ELLIPSE?(I=p[0],M=p[1],D=p[2],n=n.multiply(s.IDENTITY.translate(I.x,I.y).scaleNonUniform(M/w,D/w)),I=new i(0,0),M=D=w,L(v,m,P=n.inverse().multiply(r)),g=n,p[0]=I,p[1]=M,p[2]=D):(L(f,p,n),L(v,m,r),g=s.IDENTITY)}if(f<v?(o="intersect"+f+v,h=p.concat(m)):(o="intersect"+v+f,h=m.concat(p)),a=d[o].apply(null,h),b)for(var R=0;R<a.points.length;R++)a.points[R]=a.points[R].transform(g)}else a=new y;return a}for(var f in u[x.PATH]=d.intersectPathShape,u[x.POLYLINE]=d.intersectLinesShape,u[x.POLYGON]=d.intersectLinesShape,u[x.RECT]=d.intersectLinesShape,u[x.ROUNDRECT]=d.intersectPathShape,u[x.ARC]=d.intersectArcShape,l)l.hasOwnProperty(f)&&(d[f]=l[f]);e.exports=m},{"./Intersection":9,"./IntersectionParams":10,"./functions/bezier":11,"kld-affine":1,"kld-polynomial":5}]},{},[8])(8)},941:(t,e,n)=>{"use strict";t.exports=n.p+"ea173d9e64c008dd274d.png"},339:(t,e,n)=>{"use strict";t.exports=n.p+"16f0522a0fcf41367022.png"},36:(t,e,n)=>{"use strict";t.exports=n.p+"eae2b997bc7cd8d6f454.png"},510:(t,e,n)=>{"use strict";t.exports=n.p+"667df059ddf407979d68.png"},881:(t,e,n)=>{"use strict";t.exports=n.p+"11b155596f538bb35fa8.png"},969:(t,e,n)=>{"use strict";t.exports=n.p+"8723143bca4c2d5b26c1.png"},994:(t,e,n)=>{"use strict";t.exports=n.p+"5ac95bba9400fe31bb36.png"},270:(t,e,n)=>{"use strict";t.exports=n.p+"2706ff2394c6059a891e.png"},364:(t,e,n)=>{"use strict";t.exports=n.p+"982cc6948f5cd7af3b90.png"}},e={};function n(i){var r=e[i];if(void 0!==r)return r.exports;var s=e[i]={exports:{}};return t[i](s,s.exports,n),s.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{var t;n.g.importScripts&&(t=n.g.location+"");var e=n.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var i=e.getElementsByTagName("script");i.length&&(t=i[i.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=t})(),(()=>{"use strict";class t{static getMonthsWithHolidays(){let e=this.months.map((t=>t.name));return e.push(t.holidaysLabel),e}static isHoliday(e){return t.holidays.has(e)}static getMonthByDay(e){return t.months.find((t=>e>=t.firstDay&&e<=t.lastDay))}static getYear(e){return Math.floor(e/t.daysInYear)}static getDayInYear(e){let n=e%t.daysInYear;return n<0&&(n=t.daysInYear+n),n}static getMonth(e){let n=t.getDayInYear(e);return t.isHoliday(n)?t.holidaysLabel:t.getMonthByDay(n).name}static getDaysList(e){return e===t.holidaysLabel?[...this.holidays.values()]:[...Array(30).keys()].map((t=>(t+1).toString()))}static getDay(e){let n=t.getDayInYear(e);return t.isHoliday(n)?t.holidays.get(n):(n-t.getMonthByDay(n).firstDay+1).toString()}static getDayFromZero(e,n,i){let r;if(n===t.holidaysLabel)r=[...t.holidays.entries()].find((([t,n])=>n==e))[0];else{r=t.months.find((t=>n==t.name)).firstDay+parseInt(e)-1}return i*t.daysInYear+r}static getDateName(e){let n=t.getYear(e),i=t.getDayInYear(e);if(t.isHoliday(i)){return t.holidays.get(i)+" "+n}{let t=this.getMonthByDay(i);return i-t.firstDay+1+". "+t.name+" "+n}}}t.daysInYear=370,t.holidaysLabel="Svátky",t.months=[{firstDay:0,lastDay:29,name:"Chladen"},{firstDay:30,lastDay:59,name:"Kliden"},{firstDay:61,lastDay:90,name:"Novorost"},{firstDay:92,lastDay:121,name:"Rozkvet"},{firstDay:122,lastDay:151,name:"Zelenec"},{firstDay:154,lastDay:183,name:"Ploden"},{firstDay:185,lastDay:214,name:"Žluten"},{firstDay:215,lastDay:244,name:"Úmor"},{firstDay:246,lastDay:275,name:"Traven"},{firstDay:277,lastDay:306,name:"Ovocen"},{firstDay:307,lastDay:336,name:"Větrnec"},{firstDay:339,lastDay:368,name:"Dešten"}],t.holidays=new Map([[60,"Den pústu"],[91,"Den očištění"],[152,"Sv. letních duchů 1"],[153,"Sv. letních duchů 2"],[184,"Sv. mladých srdcí"],[245,"Den hojnosti"],[276,"Den zákonů"],[337,"Sv. zimních duchů 1"],[338,"Sv. zimních duchů 2"],[369,"Sv. proroků"]]);const e=t;var i=n(471);let r=null,s={shift:!1,ctrl:!1,up:!1,down:!1,d:!1,a:!1,esc:!1},a=new class{url="https://asteriontimelinesvisualisation.up.railway.app";data=[];active=[];activeOrder=[];minDate=0;maxDate=0;lowerEnd=-100;upperEnd=-50;colorPallete=[{color:"#d25800",users:0},{color:"#09ff00",users:0},{color:"#0873b3",users:0},{color:"#ffcdaa",users:0},{color:"#b535ba",users:0},{color:"#00fffb",users:0},{color:"#ff0900",users:0},{color:"#fff200",users:0},{color:"#003500",users:0},{color:"#0000ff",users:0},{color:"#ff29ff",users:0},{color:"#8a9800",users:0},{color:"#009800",users:0},{color:"#dc0068",users:0},{color:"#fa8775",users:0},{color:"#a7cc82",users:0},{color:"#4b19a9",users:0},{color:"#c9a600",users:0},{color:"#29ade4",users:0},{color:"#a400ec",users:0},{color:"#38c66f",users:0},{color:"#d0ade7",users:0},{color:"#050067",users:0},{color:"#9b709a",users:0},{color:"#70ffb3",users:0},{color:"#ff9bff",users:0},{color:"#993f00",users:0},{color:"#bfb287",users:0},{color:"#92315b",users:0},{color:"#8c8c8c",users:0}];xt=d3.scaleLinear();xt2=d3.scaleLinear();area=d3.area();axis=d3.axisBottom(this.xt2).ticks(15).tickSizeInner(-900).tickSizeOuter(0);brush=void 0;zoom=d3.zoom().scaleExtent([1,1/0]);constructor(){this.area.curve(d3.curveMonotoneX).x((t=>this.xt2(t.x))).y0(0).y((t=>t.y))}shuffelArray(t){let e,n=t.length;for(;n;)e=Math.floor(Math.random()*n--),[t[e],t[n]]=[t[n],t[e]];return t}shuffelColors(){this.colorPallete=this.shuffelArray(this.colorPallete)}updateScales(){let t=d3.select("#minimap_Bound"),n=this.active.map((t=>t.events.map((t=>t.begin)))).flat().sort(((t,e)=>t>e));this.minDate=n[0],this.maxDate=n[n.length-1],this.xt.domain([this.minDate+this.lowerEnd,this.maxDate]).range([0,Number(t.attr("width"))]),this.xt2.domain(this.xt.domain()).range([200,Number(d3.select(".canvasDraw").node().clientWidth)+this.upperEnd]),d3.select("#start_time").text(e.getDateName(this.minDate)),d3.select("#end_time").text(e.getDateName(this.maxDate)),d3.select("#gb").call(this.brush).call(this.brush.move,this.xt.range().map((e=>e+Number(t.attr("x"))))),d3.select("#zoom").call(this.zoom),d3.select("#timestamps").call(this.axis)}setBrush(t,e){this.brush=d3.brushX().extent([[t.x,4],[t.x+t.width,30]]).on("brush",e),d3.select("#gb").call(this.brush).call(this.brush.move,this.xt.range().map((e=>e+t.x)))}setZoom(t,e){let n=[[0,0],[t.width,d3.select(".canvasDraw").node().clientHeight]];this.zoom.extent(n).translateExtent(n).on("zoom",e),d3.select("#zoom").attr("width",d3.select(".canvasDraw").node().clientWidth-200).attr("height",d3.select(".canvasDraw").node().clientHeight).attr("transform","translate(200,0)").call(this.zoom)}updateBrushZoomAxis(t){let e=[[0,0],[t.width,d3.select(".canvasDraw").node().clientHeight]];this.brush.extent([[t.x,4],[t.x+t.width,30]]),d3.select("#zoom").attr("width",d3.select(".canvasDraw").node().clientWidth-200).attr("height",d3.select(".canvasDraw").node().clientHeight),this.zoom.extent(e).translateExtent(e),this.axis.tickSizeInner(230-d3.select(".canvasDraw").node().clientHeight)}getNextFreeColor(){for(let t of this.colorPallete)if(!t.users)return t.users++,t.color;let t=d3.select("#edit_color").node().value;return this.setColor(t),t}setColor(t){let e=this.colorPallete.findIndex((e=>e.color===t));-1!==e&&this.colorPallete[e].users++}unsetColor(t){let e=this.colorPallete.findIndex((e=>e.color===t));-1!==e&&(this.colorPallete[e].users--,this.colorPallete[e].users<0&&(this.colorPallete[e].users=0))}changeColor(t,e){this.unsetColor(t),this.setColor(e)}removeAll(){this.active.length>0&&(this.active=[],this.colorPallete.forEach((t=>t.users=0)))}removeSelected(t){if(t){let e=this.active.findIndex((e=>e.clsName===t));this.active.splice(e,1)}}},o=new class{pathShift=50;diff=150;connShift=25;min=0;max=0;extend=3e4;constructor(t){this.context=t}getMinIdxFrom(t,e){return e.indexOf(t.reduce(((t,n)=>{let i,r=e.indexOf(t),s=e.indexOf(n);return i=-1===r&&-1===s?t:-1!==r&&-1===s||-1===r&&-1!==s?-1===r?n:t:r<s?t:n,i})))}makePathItemPerson(){}makePathOther(){}makePathEvents(t,e,n,i,r,s,a){for(let o of t.events){let y=o.filters.map((t=>t.name)),l=e.map((t=>t.name)),x=this.getMinIdxFrom(y,l),c={id:o.id,name:o.name,desc:o.description,icon:o.icon.path,filters:y,cls:t.name,bck_x:o.begin,y:void 0};if(y.some((t=>l.indexOf(t)>=0))){let t=void 0!==o.end?o.end-o.begin:1,s=e[x].start>i?-1:1;if(r.push({x:o.begin-this.pathShift,y:i},{x:o.begin,y:e[x].start+s*this.connShift},{x:o.begin+t,y:e[x].start+s*this.connShift},{x:o.begin+t+this.pathShift,y:i}),o.begin+this.pathShift>this.max&&(this.max=o.begin+this.pathShift),o.begin-this.pathShift<this.min&&(this.min=o.begin-this.pathShift),!y.some((t=>n.indexOf(t)>=0))){let t=e[x].start+(-1===s?s*this.connShift*3:this.connShift),n=a.find((e=>e.x===c.begin&&e.y===t&&e.id!==o.id));c.y=t,void 0===n?a.push({x:o.begin,y:t,eventlist:[c]}):n.eventlist.push(c)}}else y.some((t=>n.indexOf(t)>=0))||(c.y=i-this.connShift,s.push(c))}}makeView(){let t=[],e=[],n=d3.select(".canvasDraw").node().clientHeight/2,i=[];this.context.activeOrder=[];let r=this.context.active.map((t=>t.name));for(let[s,a]of this.context.active.entries()){this.min=this.context.minDate-this.pathShift,this.max=this.context.maxDate+this.pathShift,r.splice(r.indexOf(a.name),1),n+=(s%2==0?s:-s)*this.diff,s%2==0?this.context.activeOrder.push(a.clsName):this.context.activeOrder.unshift(a.clsName);let o=[{x:this.min-this.extend,y:n}];this.makePathEvents(a,e,r,n,o,t,i),o.push({x:this.max+this.extend,y:n}),e.push({name:a.name,clsName:a.clsName,start:n,datum:o,color:a.color,imgPath:a.iconPath})}return{paths:e,events:t,commonEvents:i}}randomOrder(t){this.context.updateScales();const e=this.context.active.length;let n=[...Array(e).keys()];n=this.context.shuffelArray(n),this.context.active=n.map((t=>this.context.active[t])),t.drawRes(this.makeView())}permutate(t,e){let n=new Array(e).fill(0),i=[[...t]],r=1;for(;r<e;)n[r]<r?(r%2==0?[t[0],t[r]]=[t[r],t[0]]:[t[n[r]],t[r]]=[t[r],t[n[r]]],i.push([...t]),n[r]++,r=1):(n[r]=0,r++);return i}getNumberOfIntersection(t){let e=t.map((t=>t.datum)),n=[],r=0;for(let t=0;t<e.length;t++)for(let i=t+1;i<e.length;i++)n.push([t,i]);for(let[t,s]of n){r+=i.intersect(i.shape("path",{d:this.context.area(e[t])}),i.shape("path",{d:this.context.area(e[s])})).points.length}return r}bruteForceOrder(t){this.context.updateScales();const e=this.context.active.length,n=[...Array(e).keys()],i=this.permutate(n,e);let r;for(let t of i){this.context.active=t.map((t=>this.context.active[t]));let e=this.makeView(this.context.active),n=this.getNumberOfIntersection(e.paths);(void 0===r||r.numInt>n)&&(r={numInt:n,perm:t,res:e})}this.context.active=r.perm.map((t=>this.context.active[t])),t.drawRes(r.res)}getEdges(t,e){let n=[];return t.forEach((t=>{let i=t.filters.map((t=>t.name));i.forEach((t=>{i.forEach((i=>{t!==i&&-1!==e.indexOf(t)&&-1!==e.indexOf(i)&&n.push({source:e.indexOf(t),target:e.indexOf(i)})}))}))})),n}getEvents(t){let e=t.map((t=>t.events)).flat();return e=e.filter(((t,e,n)=>e===n.findIndex((e=>e.place===t.place&&e.id===t.id)))),e}makeFrequencyTable(t){let e=[],n=this.getEvents(this.context.active);return this.context.active.forEach((n=>e.push({idx:this.context.active.indexOf(n),freq:Array(t.length+1).fill(0)}))),this.getEdges(n,t).forEach((n=>{e[n.source].freq[n.target]++,e[n.target].freq[t.length]++})),e}frequencyTable(t){this.context.updateScales();const e=this.context.active.map((t=>t.name));let n=this.makeFrequencyTable(e);n.sort(((t,i)=>{if(t.freq[e.length]<i.freq[e.length])return 1;if(t.freq[e.length]!==i.freq[e.length])return-1;for(let r=0;r<e.length;r++)if(t.freq[r]!==i.freq[r]&&n.indexOf(t)!==r&&n.indexOf(i)!==r)return t.freq[r]>i.freq[r]}));const i=n.map((t=>t.idx));this.context.active=i.map((t=>this.context.active[t])),t.drawRes(this.makeView())}getRndNumber(t,e){return Math.random()*(e-t+1)+t}drawNodes=(t,e,n)=>{let i=null;n&&(i=t.selectAll(".edge").data(n).enter().append("line").classed("edge",!0).attr("x1",(t=>e[t.source].x)).attr("y1",(t=>e[t.source].y)).attr("x2",(t=>e[t.target].x)).attr("y2",(t=>e[t.target].y)).style("stroke","#bbb"));return[t.selectAll(".node").data(e).enter().append("circle").classed("node",!0).attr("cx",(t=>t.x)).attr("cy",(t=>t.y)).attr("r","10"),i]};forceMethod(t){this.context.updateScales();const e=this.context.active.map((t=>t.name));let n=[];e.forEach((t=>n.push({id:t.index,x:150,y:this.getRndNumber(200,600)})));let i=this.makeFrequencyTable(e),r=[];for(let t=0;t<e.length;t++)for(let n=t+1;n<e.length;n++)i[t].freq[n]&&r.push({source:t,target:n,weight:i[t].freq[n]});let s=d3.scaleLinear().domain(d3.extent(r,(t=>t.weight))).range([.1,1]);d3.forceSimulation().nodes(n).force("link",d3.forceLink(r).strength((t=>s(t.weight))).distance(0)).force("x",d3.forceX(150)).force("collide",d3.forceCollide().radius(10)).force("charge",d3.forceManyBody().strength(1)).on("end",(()=>{n.sort(((t,e)=>t.y-e.y));const e=n.map((t=>t.index));this.context.active=e.map((t=>this.context.active[t])),t.drawRes(this.makeView())}))}}(a),y=new class{minWidthEvent=50;constructor(t,e){this.context=t,this.order=e,this.header=document.createElement("div"),this.minimap=document.createElement("div"),this.canvas=document.createElement("div"),this.modal_menu=document.createElement("div"),this.footer=document.createElement("div"),this.viz=document.createElement("div"),window.addEventListener("resize",(()=>{let e=d3.select(".minimapDraw");e.remove(e.firstElementChild),this.buildMinimap(),t.active.length>0&&(this.context.updateBrushZoomAxis(this.getMinimapInfo()),this.context.updateScales(),d3.select("#timestamps").attr("transform",`translate(0,${d3.select(".canvasDraw").node().clientHeight-160})`),this.drawRes(this.order.makeView())),this.moveButtons()})),this.buildViz(),document.body.append(this.viz),this.moveButtons(),this.minimapX=Number(d3.select("#minimap_Bound").attr("x")),this.minimapW=Number(d3.select("#minimap_Bound").attr("width"))}getMinimapInfo(){let t=d3.select(".minimapDraw #minimap_Bound");return this.minimapX=Number(t.attr("x")),this.minimapW=Number(t.attr("width")),{x:Number(t.attr("x")),width:Number(t.attr("width"))}}buildViz(){d3.select(this.viz).attr("id","viz"),this.buildHeader(),this.viz.append(this.header),this.buildMinimap(),this.viz.append(this.minimap),this.buildCnvs(),this.viz.append(this.canvas),this.buildModal(),this.viz.append(this.modal_menu),this.buildFooter(),this.viz.append(this.footer)}buildHeader(){d3.select(this.header).attr("id","header");d3.select(this.header).append("div").attr("class","title").append("h1").text("Asterion Timelines");const t=d3.select(this.header).append("div");t.attr("class","links"),t.append("a").attr("href","./help.html").append("img").attr("src",n(969)),t.append("a").attr("href","https://discord.com/invite/vAzSaYc").append("img").attr("src",n(510)),t.append("a").attr("href","https://asterionrpg.cz/").append("img").attr("src",n(339))}buildMinimap(){d3.select(this.minimap).attr("class","minimap");let t=this.BrowserText.getWidth(e.getDateName(0),16,"Arial Black")/3,n=this.BrowserText.getWidth(e.getDateName(3699999),16,"Arial Black")/3;const i=.12*window.innerWidth,r=.76*window.innerWidth,s=(window.innerWidth-r)/4,a=d3.select(this.minimap).append("svg").attr("class","minimapDraw");a.append("text").attr("id","start_time").attr("x",""+(s-t)).attr("y","65%").text(e.getDateName(0)),a.append("rect").attr("id","minimap_Bound").attr("x",`${i}`).attr("y","5").attr("height","25").attr("width",`${r}`),a.append("text").attr("id","end_time").attr("x",""+(i+r+s-n)).attr("y","65%").text(e.getDateName(3699999)),a.append("g").attr("id","gb")}buildCnvs(){d3.select(this.canvas).attr("class","canvas");const t=d3.select(this.canvas).append("svg").attr("class","canvasDraw").attr("height","100%").attr("width","100%");t.append("rect").attr("id","zoom"),t.append("g").attr("id","timestamps").attr("transform","translate(0,960)");const e=t.append("g").attr("transform","translate(0,0)");let i=e.append("g").attr("id","timelines");i=i.append("g").attr("id","timeline_els"),i.append("g").attr("id","paths"),e.append("rect").attr("id","lampshade").attr("x","0").attr("y","-2000").attr("height","900%").attr("width","200"),e.append("image").attr("id","selected").attr("x","40").attr("y","0").attr("width","100").attr("height","100").attr("href",n(270)),e.append("g").attr("id","emblems").attr("transform","translate(90,-50)"),this.addButtonCnvs(t,0,"add",n(941),60,10,"Přidej","příběh",10),this.addButtonCnvs(t,100,"remove",n(36),60,110,"Smaž","vše",125)}addButtonCnvs(t,e,n,i,r,s,a,o,y){let l=t.append("g").attr("id",n);l.append("rect").attr("width","100").attr("height","100").attr("x",e).attr("y","0"),l.append("image").attr("href",i).attr("width",r).attr("y","5").attr("x",s),l.append("text").text(a).attr("y","65").attr("x",y),l.append("text").text(o).attr("y","90").attr("x",y)}addButtonModal(t,e,n){t.append("button").attr("class",e).text(n)}buildModal(){const t=d3.select(this.modal_menu).attr("id","modal_menu").append("div").attr("class","content");let e=t.append("div").attr("id","buttons");this.addButtonModal(e,"close","X");e=t.append("div").attr("class","tabs").append("div").attr("id","modal_add"),e.append("p").text("Vyhledávání časových os:");let n=e.append("div").attr("class","dropdown");n.append("input").attr("class","form_control").attr("type","text").attr("value","").attr("placeholder","Začněte psát"),n.append("ul").attr("id","content").style("visibility","hidden"),e.append("button").attr("id","add_confirm").text("Přidat osu"),e.append("button").attr("id","add_example").text("Ukázka časových os"),e.append("button").attr("id","frequency").text("Frekvenční metoda"),e.append("button").attr("id","force").text("Silova metoda"),e.append("button").attr("id","random_order").text("Náhodné pořadí")}buildFooter(){const t=new Date;d3.select(this.footer).attr("id","footer"),d3.select(this.footer).append("p").text(`2021 - ${t.getFullYear()} ©`).append("a").attr("href","./about.html").text("O nás")}moveButtons(){let t=d3.select(this.canvas).node().clientHeight,e=d3.select("#add");e.attr("transform",`translate(0,${t-e.node().firstChild.attributes.height.value})`),e=d3.select("#remove"),e.attr("transform",`translate(0,${t-e.node().firstChild.attributes.height.value})`)}addImg(t,e,n,i,r,s,a,o){const y=t.append("image").attr("class",e).attr("href",n).attr("x",i).attr("y",r).attr("height",s).attr("width",a);void 0!==o&&y.attr("transform",o)}setPath(t,e,n,i){t.datum(e).attr("class",n).attr("stroke",i).attr("d",this.context.area)}fillPaths(t,e){let n=null!==t.node()?t.node().firstElementChild:null,i=0;for(;i<e.length;i++)null!==n?(this.setPath(d3.select(n),e[i].datum,e[i].clsName,e[i].color),n=n.nextElementSibling,this.setPath(d3.select(n),[e[i].datum[0],e[i].datum[e[i].datum.length-1]],e[i].clsName+" sec_path",e[i].color),n=n.nextElementSibling):(this.setPath(t.append("path"),e[i].datum,e[i].clsName,e[i].color),this.setPath(t.append("path"),[e[i].datum[0],e[i].datum[e[i].datum.length-1]],e[i].clsName+" sec_path",e[i].color));if(i===e.length&&n)for(n=n.previousElementSibling;t.node().lastElementChild!==n;)t.node().removeChild(t.node().lastElementChild)}fillEmblems(t,e){let n=null!==t.node()?t.node().firstElementChild:null,i=0;for(;i<e.length;i++){if(null!==n){let t=d3.select(n);t.attr("class",e[i].clsName).attr("transform",`translate(0,${e[i].start})`),t.select(".item").attr("href",e[i].imgPath),t.select("text").text(e[i].name),t.select(".colorPicker").attr("fill",e[i].color),i+1<e.length&&(n=n.nextElementSibling)}else this.addEmblem(e[i].name,e[i].clsName,e[i].start,e[i].imgPath,e[i].color);d3.select(`.inputPicker.${e[i].clsName}`).node()||d3.select(this.canvas).append("input").attr("type","color").attr("class",`inputPicker ${e[i].clsName}`)}if(i===e.length&&n)for(;t.node().lastElementChild!==n;)t.node().removeChild(t.node().lastElementChild)}addEmblem(t,e,i,r,s){const a=d3.select("#emblems").append("g").attr("class",`${e}`).attr("transform",`translate(0,${i})`);a.append("rect").attr("class","background").attr("x","-90").attr("y","-15").attr("width","190").attr("height","130"),a.append("text").attr("x","-70").attr("y","0").text(t),this.addImg(a,"item",r,"-35","10","100","100"),this.addImg(a,"up hideable",n(364),"-75","5","30","30"),this.addImg(a,"down hideable",n(364),"45","-65","30","30","rotate(180)"),this.addImg(a,"remove",n(994),"-100","-5","20","20","rotate(180)"),a.append("circle").attr("class","colorPicker hideable").attr("fill",s).attr("cx","-60").attr("cy","90").attr("r","20").attr("stroke","black").attr("stroke-width","1px")}makeDescr(t){let n=d3.select(document.createElement("div"));n.attr("id","tooltip").style("position","absolute").style("opacity",0);let i=n.append("div").attr("class","left");if(i.append("h2").text(t.name),i.append("p").attr("class","desc_date").text(e.getDateName(t.bck_x)),i.append("p").text(t.desc),t.filters.length>1){i=n.append("div").attr("class","right"),i.append("h2").text("Související časové linky"),i=i.append("ul");for(let e=0;e<t.filters.length;e++)i.append("li").text(t.filters[e])}return n}appendInfoTo(t,e){e.attr("class",this.getClass(t.cls)).attr("href",t.icon).attr("y",t.y).attr("bckp-x",t.bck_x).attr("x",this.context.xt2(t.bck_x)).attr("height",this.minWidthEvent).attr("width",this.minWidthEvent).attr("transform","translate(-"+this.minWidthEvent/2+",0)");const n=this.makeDescr(t);tippy(e.node(),{content:n.node().innerHTML,allowHTML:!0,theme:"tooltip",placement:"left",duration:[500,200]})}appendMinimapMark(t){d3.select(".minimapDraw").append("circle").attr("class",`miniEvent ${this.getClass(t.cls)}`).attr("r","5").attr("cx",`${this.context.xt(t.bck_x)+this.minimapX}`).attr("cy","17.5").attr("fill",d3.select(`#paths .${this.getClass(t.cls)}`).attr("stroke"))}placeEvents(t,e){for(let n of e)this.appendInfoTo(n,t.append("image")),this.appendMinimapMark(n)}placeGroup(t,e,i,r){let s=t.append("g").attr("class","group").on("mouseover",(t=>{const e=d3.select(t.target.parentNode).select("rect"),n=e.attr("length");e.attr("width",50*n),d3.select(t.target.parentNode).select(".placeholder").attr("display","none"),d3.select(t.target.parentNode).selectAll(".hideable").nodes().forEach((t=>d3.select(t).attr("display","inherit")))})).on("mouseout",(t=>{d3.select(t.target.parentNode).select("rect").attr("width",this.minWidthEvent),d3.select(t.target.parentNode).select(".placeholder").attr("display","inherit"),d3.select(t.target.parentNode).selectAll(".hideable").nodes().forEach((t=>d3.select(t).attr("display","none")))}));return s.append("rect").attr("x",e).attr("bckp-x",e).attr("y",i).attr("width",this.minWidthEvent).attr("fill","antiquewhite").attr("length",r).attr("transform","translate(-"+this.minWidthEvent/2+",0)"),s.append("image").attr("href",n(881)).attr("class","placeholder").attr("x",e).attr("bckp-x",e).attr("y",i).attr("transform","translate(-"+this.minWidthEvent/2+",0)"),s}placeCommonEvents(t,e){for(let n of e){if(1===n.eventlist.length)this.appendInfoTo(n.eventlist[0],t.append("image"));else{let e=this.placeGroup(t,n.eventlist[0].x,n.eventlist[0].y,n.eventlist.length);for(let[t,i]in n.eventlist.entries())i.bck_x=i.bck_x+t*this.minWidthEvent,this.appendInfoTo(i,e.append("image"))}this.appendMinimapMark(n.eventlist[0])}}drawRes(t){this.fillPaths(d3.select("#paths"),t.paths),this.fillEmblems(d3.select("#emblems"),t.paths);let e=d3.select("#timeline_els");d3.selectAll("#timeline_els .group").remove(),d3.selectAll("#timeline_els image").remove(),d3.selectAll(".minimapDraw .miniEvent").remove(),this.placeEvents(e,t.events),this.placeCommonEvents(e,t.commonEvents)}removeSpecificItems(t){for(let e of t)d3.selectAll(e).remove()}removeItems(){for(let t of["#timeline_els .group","#timeline_els image",".minimapDraw .miniEvent","#paths path","#emblems g",".inputPicker"])d3.selectAll(t).remove()}rescaleTimeline(){d3.select("#timelines").selectAll("image").nodes().forEach(((t,e)=>{const n=Number(d3.select(t).attr("bckp-x"));d3.select(t).attr("x",`${this.context.xt2(n)}`)}))}rescaleGroups(t){let e=Number(d3.select(this).attr("bckp-x"));d3.select(this).attr("x",`${this.context.xt2(e)}`),e=d3.select(this).select(".placehlder").attr("bckp-x"),d3.select(this).select(".placehlder").attr("x",`${this.context.xt2(e)}`)}getClass(t){return t.split(" ").join("").replaceAll(".","")}setStyle(t,e,n){d3.select(t).style(e,n)}getStyle(t,e){return d3.select(t).style(e)}setAttrib(t,e,n){d3.select(t).attr(e,n)}getAttrib(t,e){return d3.select(t).attr(e)}setCallBack(t,e,n){d3.select(t).on(e,n)}getElement(t){return d3.select(t)}getAllElements(t){return d3.selectAll(t)}BrowserText=function(){let t=document.createElement("canvas").getContext("2d");return{getWidth:function(e,n,i){return t.font=n+"px "+i,t.measureText(e).width}}}()}(a,o),l=new class{constructor(t){this.context=t}searchItem={name:"",id:-1};fillSearchItem(t,e,n){this.searchItem.name=t,this.searchItem.id=Number(e)}changeSearched(t,e){t=t.target,d3.selectAll("#content .searchSel").nodes().forEach((t=>{"searchSel"===t.attributes.class.value&&(t.attributes.class.value="")})),e.fillSearchItem(t.textContent,t.attributes.ida.value,t.attributes.cat.value),t.attributes.class.value="searchSel",d3.select(".form_control").node().value=t.textContent,d3.select("#content").style("visibility","hidden")}fillDropDown(t,e){let n=t.node().firstElementChild,i=0;for(;i<e.length;i++)n?(d3.select(n).attr("ida",e[i].id),d3.select(n).attr("cat",e[i].category.id),d3.select(n).text(e[i].name),i+1<e.length&&(n=n.nextElementSibling)):t.append("li").attr("ida",e[i].id).attr("cat",e[i].category.id).attr("class","").on("click",(t=>{this.changeSearched(t,this)})).text(e[i].name);if(i===e.length&&n)for(;t.node().lastElementChild!==n;)t.node().removeChild(t.node().lastElementChild);if(0===e.length)for(;t.node().lastElementChild;)t.node().removeChild(t.node().lastElementChild)}async fetchTags(t,e){let n=await fetch(this.context.url+`/tag/byContent?search=${t}`);e=await n.json();for(const t of e)this.context.data.some((e=>e.name===t.name))||this.context.data.push({name:t.name,clsName:t.name.split(" ").join("").replaceAll(".",""),id:t.id,category:{id:t.category.id,icon:t.category.icon},icon:t.icon?t.icon.path:void 0,events:void 0})}async searchCats(){const t=d3.select("#content"),e=d3.select(".form_control").node().value;if(""!==e){d3.select("#content").style("visibility","inherit");let n=this.context.data.filter((t=>t.name.includes(e)));n.length||(await this.fetchTags(e,n),n=this.context.data.filter((t=>t.name.includes(e)))),this.fillDropDown(t,n)}else d3.select("#content").style("visibility","hidden"),d3.selectAll("#content").each((function(t,e){d3.select(this).attr.class=""})),this.fillSearchItem("",-1,-1)}async saveToBuffer(){let t=this.context.data.findIndex((t=>t.id===this.searchItem.id)),e=this.context.data[t];if(-1!==t){if(void 0===e.events){let t=await fetch(this.context.url+`/event/byFilterId?id=${this.searchItem.id}`);e.events=await t.json()}0!==e.events.length&&void 0===this.context.active.find((t=>t.id===this.searchItem.id))&&this.context.active.push({name:this.searchItem.name,clsName:e.clsName,id:this.searchItem.id,events:e.events,color:this.context.getNextFreeColor(),iconPath:void 0!==e.icon?e.icon:void 0!==e.category.icon?e.category.icon.path:"/img/tags/black-box.png"})}}clearElement(t){const e=d3.select(t);for(;e.node().firstElementChild;)e.node().removeChild(e.node().lastElementChild)}iterateEvents(t,e){const n=d3.select("#eventsResult");n.append("h2").text(t+" - počet událostí:"+e.length);for(const t of e){const e=n.append("ul");e.append("li").text("id: "+t.id),e.append("li").text("Nazev: "+t.name),e.append("li").text("Popis: "+t.description),e.append("li").text("Zacatek: "+t.begin),e.append("li").text("IconsPath: "+t.icon.path)}n.append("hr")}async showEventsToId(){this.clearElement("#eventsResult");let t=await fetch(this.context.url+`/event/byFilterId?id=${searchItem.id}`),e=await t.json();this.iterateEvents(this.searchItem.name,e)}}(a),x=y.getElement("#modal_menu"),c=!1;function h(){a.active.length>0?(M(),y.getAllElements("#emblems .item").nodes().forEach((t=>y.setCallBack(t,"click",w))),y.getAllElements("#emblems .up").nodes().forEach((t=>y.setCallBack(t,"click",P))),y.getAllElements("#emblems .down").nodes().forEach((t=>y.setCallBack(t,"click",k))),y.getAllElements("#emblems .remove").nodes().forEach((t=>y.setCallBack(t,"click",d))),y.getAllElements(".colorPicker").nodes().forEach((t=>y.setCallBack(t,"click",u))),y.getAllElements(".inputPicker").nodes().forEach((t=>y.setCallBack(t,"input",m)))):y.removeItems()}async function p(){await l.saveToBuffer(),h()}function d(t){let e=t.target.parentElement.className.baseVal;a.removeSelected(e),y.removeSpecificItems([`.inputPicker.${e}`]),r?.className.baseVal===e&&b(),h()}function u(t){let e=t.target.parentNode.attributes.class.value,n=y.getElement(`.inputPicker.${e}`);n.attr("value",t.target.attributes.fill.value),n.node().click()}function m(t){let e=t.target.value,n=t.target.classList[t.target.classList.length-1];a.changeColor(t.target.defaultValue,e),t.target.defaultValue=e;let i=a.active.findIndex((t=>t.name===n));a.active[i].color=e,y.getAllElements(`.minimapDraw .${n}`).nodes().forEach((t=>{y.setAttrib(t,"fill",e)})),y.getAllElements(`#paths .${n}`).nodes().forEach((t=>{y.setAttrib(t,"stroke",e)})),y.setAttrib(`#emblems .${n} .colorPicker`,"fill",e)}function f(){c=!0,x.style("display","inherit")}function v(){y.getElement(".dropdown .form_control").node().value="",c=!1,x.style("display","none")}function g(){y.setStyle("#modal_add","visibility","inherit"),y.setStyle("#add_confirm","visibility","inherit"),y.setStyle("#add_example","visibility","inherit")}function w(t){const e=y.getElement("#selected");null===r&&e.style("display","inherit"),r=y.getElement(this.parentNode).node();const n=Number(r.transform.baseVal.consolidate().matrix.f);e.attr("y",""+(n-30))}function b(){r=null,y.setStyle("#selected","display","none")}function E(t,e){let n=a.activeOrder[t],i=a.activeOrder[e],s=r?r.className.baseVal:void 0,l=a.active.findIndex((t=>t.clsName===n)),x=a.active.findIndex((t=>t.clsName===i));[a.active[l],a.active[x]]=[a.active[x],a.active[l]],[a.activeOrder[t],a.activeOrder[e]]=[a.activeOrder[e],a.activeOrder[t]],y.drawRes(o.makeView()),s===n&&I(n),s===i&&I(i)}function P(){let t=a.activeOrder.findIndex((t=>t===this.parentNode.className.baseVal));0!==t&&E(t,t-1)}function k(){let t=a.activeOrder.findIndex((t=>t===this.parentNode.className.baseVal));t!==a.active.length-1&&E(t,t+1)}function I(t){null!==r&&y.getElement(`#emblems .${t} .item`).dispatch("click")}async function M(){let t=r?.className.baseVal;o.frequencyTable(y),t&&D(t)}function D(t){y.getElement(`#emblems .${t} .item`).dispatch("click")}y.setCallBack(".form_control","keyup",(t=>{"Escape"!==t.key&&"ArrowUp"!==t.key&&"ArrowDown"!==t.key&&"ArrowLeft"!==t.key&&"ArrowRight"!==t.key&&"Enter"!==t.key&&l.searchCats()})),y.setCallBack(".dropdown","keyup",(function(t){if(t.preventDefault(),""!==y.getElement(".form_control").node().value&&("ArrowUp"===t.key||"ArrowDown"===t.key||"Enter"===t.key)){const e=y.getElement("#content").node();let n=y.getElement("#content .searchSel").node();"ArrowUp"===t.key&&(n?(n.attributes.class.value="",n.previousElementSibling?n.previousElementSibling.attributes.class.value="searchSel":e.lastElementChild.attributes.class.value="searchSel"):e.lastElementChild.attributes.class.value="searchSel",n=y.getElement("#content .searchSel").node(),n.scrollIntoView(!0)),"ArrowDown"===t.key&&(n?(n.attributes.class.value="",n.nextElementSibling?n.nextElementSibling.attributes.class.value="searchSel":e.firstElementChild.attributes.class.value="searchSel"):e.firstElementChild.attributes.class.value="searchSel",n=y.getElement("#content .searchSel").node(),n.scrollIntoView(!0)),"Enter"===t.key&&(y.getElement(n).dispatch("click"),y.setStyle("#content","visibility","hidden"))}})),y.setCallBack("#modal_menu","keyup",(t=>{"Escape"===t.key&&y.setStyle("#content","visibility","hidden")})),y.setCallBack("#add","click",(()=>{f(),g()})),y.setCallBack("body","keydown",(function(t){"Shift"===t.key&&(s.shift=!0);"Control"===t.key&&(s.ctrl=!0);"ArrowUp"===t.key&&(s.up=!0);"ArrowDown"===t.key&&(s.down=!0);"a"===t.key&&(s.a=!0);"d"===t.key&&(s.d=!0);"Escape"===t.key&&(s.esc=!0);s.esc&&c&&"hidden"===y.getStyle("#content","visibility")?v():s.esc&&null!==r&&"hidden"===y.getStyle("#content","visibility")&&b();s.shift&&s.up&&null!==r&&"hidden"===y.getStyle("#content","visibility")&&(t.preventDefault(),y.getElement(r).select(".up").dispatch("click"));s.shift&&s.down&&null!==r&&"hidden"===y.getStyle("#content","visibility")&&(t.preventDefault(),y.getElement(r).select(".down").dispatch("click"));s.ctrl&&s.a&&(t.preventDefault(),f(),g());if(s.up&&!s.shift&&null!==r&&"hidden"===y.getStyle("#content","visibility")&&(t.preventDefault(),a.activeOrder.length)){const t=a.activeOrder.findIndex((t=>t===r.className.baseVal))-1;-1!==t&&y.getElement(`#emblems .${a.activeOrder[t]} .item`).dispatch("click")}if(s.up&&!s.shift&&null===r&&"hidden"===y.getStyle("#content","visibility")&&(t.preventDefault(),a.activeOrder.length)){const t=a.activeOrder.length-1;y.getElement(`#emblems .${a.activeOrder[t]} .item`).dispatch("click")}if(s.down&&!s.shift&&null!==r&&"hidden"===y.getStyle("#content","visibility")&&(t.preventDefault(),a.activeOrder.length)){const t=a.activeOrder.findIndex((t=>t===r.className.baseVal))+1;t!==a.activeOrder.length&&y.getElement(`#emblems .${a.activeOrder[t]} .item`).dispatch("click")}s.down&&!s.shift&&null===r&&"hidden"===y.getStyle("#content","visibility")&&(t.preventDefault(),a.activeOrder.length&&y.getElement(`#emblems .${a.activeOrder[0]} .item`).dispatch("click"))})),y.setCallBack("body","keyup",(function(t){"Shift"===t.key&&(s.shift=!1);"Control"===t.key&&(s.ctrl=!1);"ArrowUp"===t.key&&(s.up=!1);"ArrowDown"===t.key&&(s.down=!1);"a"===t.key&&(s.a=!1);"d"===t.key&&(s.d=!1);"Escape"===t.key&&(s.esc=!1)})),y.setCallBack("#buttons .close","click",v),y.setCallBack("#add_confirm","click",p),y.setCallBack("#frequency","click",M),y.setCallBack("#force","click",(async function(){let t=r?.className.baseVal;o.forceMethod(y),t&&D(t)})),y.setCallBack("#random_order","click",(async function(){let t=r?.className.baseVal;o.randomOrder(y),t&&D(t)})),y.setCallBack("#add_example","click",(async function(){const t=[3,19,88,71,40,13,69,21],e=["Almendor","Danérie","Storabsko","Podzemní říše","Keledor","Boševal","Plavena","Detreon"];for(let n=0;n<e.length;n++)l.searchItem.id=t[n],l.searchItem.name=e[n],await l.fetchTags(e[n],[]),await p();l.searchItem.id=-1,l.searchItem.name=""})),y.setCallBack("#remove","click",(function(){y.removeItems(),a.removeAll()}));let N=y.getMinimapInfo();a.shuffelColors(),a.setBrush(N,(function(t){if(t.sourceEvent&&"zoom"===t.sourceEvent.type)return;let e=t.selection||a.xt.range();e=e.map((t=>t-y.minimapX)),a.xt2.domain(e.map(a.xt.invert,a.xt));for(let t of y.getElement("#paths").node().children)y.getElement(t).attr("d",a.area);y.rescaleTimeline(),y.getElement("#timestamps").call(a.axis),y.getElement("#zoom").call(a.zoom.transform,d3.zoomIdentity.scale(y.minimapW/(e[1]-e[0])).translate(-e[0],0),null,t)})),a.setZoom(N,(function(t){if(t.sourceEvent&&"brush"===t.sourceEvent.type)return;let e=t.transform;a.xt2.domain(e.rescaleX(a.xt).domain());for(let t of y.getElement("#paths").node().children)y.getElement(t).attr("d",a.area);if(t.sourceEvent){let e=y.getElement(y.getElement("#timelines").node().parentNode),n=Number(e.node().transform.baseVal.consolidate().matrix.f);e.attr("transform",`translate(0,${n+t.sourceEvent.movementY})`)}y.rescaleTimeline(),y.getElement("#timestamps").call(a.axis),y.getElement("#gb").call(a.brush.move,a.xt.range().map(e.invertX,e).map((t=>t+y.minimapX)),t)})),a.axis.tickFormat((t=>e.getDateName(t))),a.updateBrushZoomAxis(N),y.getElement("#timestamps").attr("transform",`translate(0,${y.getElement(".canvasDraw").node().clientHeight-160})`)})()})();
//# sourceMappingURL=viz.bundle.js.map